<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=/ja/documentation/grid/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Grid | Selenium</title><meta name=description content="複数のマシンで並行してテストを実行したいですか？ Grid が手助けします。
"><meta property="og:title" content="Grid"><meta property="og:description" content="複数のマシンで並行してテストを実行したいですか？ Grid が手助けします。
"><meta property="og:type" content="website"><meta property="og:url" content="/ja/documentation/grid/"><meta property="og:image" content="/images/selenium_4_logo.png"><meta property="og:site_name" content="Selenium"><meta itemprop=name content="Grid"><meta itemprop=description content="複数のマシンで並行してテストを実行したいですか？ Grid が手助けします。
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/selenium_4_logo.png"><meta name=twitter:title content="Grid"><meta name=twitter:description content="複数のマシンで並行してテストを実行したいですか？ Grid が手助けします。
"><link rel=preload href=/scss/main.min.30eaa91960da82a2c85d5cea1c96b5adce89ff7d7ea6e9bd78f92adceda13901.css as=style><link href=/scss/main.min.30eaa91960da82a2c85d5cea1c96b5adce89ff7d7ea6e9bd78f92adceda13901.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3><script defer data-domain=selenium.dev src=https://plausible.io/js/plausible.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-lg navbar-light bg-white flex-row td-navbar"><a class=navbar-brand href=/ja/><span class=navbar-logo><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 139.38 34"><defs><style>.cls-1{fill:#43b02a}</style></defs><title>Selenium logo green</title><path class="cls-1" d="M46.2 26.37a18.85 18.85.0 01-2.57-.2 25 25 0 01-2.74-.53v-1.39a25.31 25.31.0 002.71.53 18 18 0 002.5.2 5.51 5.51.0 003.29-.84 2.79 2.79.0 001.14-2.39 2.85 2.85.0 00-1.24-2.49A6 6 0 0048 18.55q-.78-.29-1.67-.55A15.93 15.93.0 0144 17.13a5.92 5.92.0 01-1.58-1.05 3.6 3.6.0 01-.9-1.34A5 5 0 0141.23 13a4.46 4.46.0 01.41-1.93 4.31 4.31.0 011.17-1.5 5.26 5.26.0 011.82-1A8 8 0 0147 8.28a20.51 20.51.0 014.41.57v1.42a20 20 0 00-2.23-.44 15.2 15.2.0 00-2-.15 4.86 4.86.0 00-3.08.9A2.9 2.9.0 0042.88 13a3.25 3.25.0 00.21 1.21 2.61 2.61.0 00.7 1 4.83 4.83.0 001.27.79 14.31 14.31.0 002 .68q1.11.33 2.06.71a6.21 6.21.0 011.65.94 4.09 4.09.0 011.1 1.38 4.54 4.54.0 01.4 2 4.15 4.15.0 01-1.56 3.48A7.16 7.16.0 0146.2 26.37z"/><path class="cls-1" d="M60.62 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0154.88 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0165.1 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H56.44a5.39 5.39.0 001.17 3.5A4.18 4.18.0 0060.8 25a10.52 10.52.0 001.82-.17 11.77 11.77.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0160.62 26.32zM60.4 14.43q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0060.4 14.43z"/><path class="cls-1" d="M68.64 7h1.58V26.11H68.64z"/><path class="cls-1" d="M79.56 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0173.83 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0184 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H75.38a5.4 5.4.0 001.17 3.5A4.18 4.18.0 0079.75 25a10.52 10.52.0 001.82-.17 11.8 11.8.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0179.56 26.32zm-.21-11.89q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0079.35 14.43z"/><path class="cls-1" d="M87.51 13.37h1.32l.12 1.49h.12q.94-.45 1.72-.78t1.43-.54a8.42 8.42.0 011.2-.31 6.54 6.54.0 011.1-.09A3.3 3.3.0 0197 14a3.63 3.63.0 01.83 2.63v9.51H96.24v-9a3 3 0 00-.55-2 2.18 2.18.0 00-1.69-.6 7.25 7.25.0 00-2.24.41 20.1 20.1.0 00-2.67 1.12v10H87.51z"/><path class="cls-1" d="M102.75 10.52a.93.93.0 01-1.06-1 1.06 1.06.0 012.12.0.93.93.0 01-1.06 1zm-.8 2.85h1.58V26.11h-1.58z"/><path class="cls-1" d="M110.81 26.34q-3.14.0-3.14-3.47v-9.5h1.58v9a3.16 3.16.0 00.48 2 1.92 1.92.0 001.59.6 6.83 6.83.0 002.48-.48q1.25-.48 2.59-1.14V13.37H118V26.11h-1.32l-.12-1.58h-.09l-1.73.81q-.74.34-1.38.57a7.9 7.9.0 01-1.23.33A7.34 7.34.0 01110.81 26.34z"/><path class="cls-1" d="M122.18 13.37h1.3l.14 1.49h.09a19.53 19.53.0 012.58-1.31 5.51 5.51.0 012-.41 2.83 2.83.0 013 1.77h.12q.8-.5 1.45-.83a12.61 12.61.0 011.2-.54 6.17 6.17.0 011-.31 5.18 5.18.0 011-.09 3.3 3.3.0 012.45.84 3.63 3.63.0 01.83 2.63v9.51h-1.56v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.14 5.14.0 00-1.78.38A14.45 14.45.0 00131.6 16v10.1H130v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.24 5.24.0 00-1.86.4A14 14 0 00123.76 16V26.11h-1.58z"/><path class="cls-1" d="M21.45 21.51a2.49 2.49.0 00-2.55 2.21.08.08.0 00.08.1h4.95a.08.08.0 00.08-.09 2.41 2.41.0 00-2.56-2.22z"/><path class="cls-1" d="M32.06 4.91 21.56 16.7a.32.32.0 01-.47.0l-5.36-5.53a.32.32.0 010-.4L17.5 8.5a.32.32.0 01.52.0l3 3.32a.32.32.0 00.49.0L29.87.36A.23.23.0 0029.69.0H.25A.25.25.0 000 .25v33.5A.25.25.0 00.25 34h32a.25.25.0 00.25-.25V5.06A.23.23.0 0032.06 4.91zm-23 25.36a8.08 8.08.0 01-5.74-2 .31.31.0 010-.41l1.25-1.75A.31.31.0 015 26a6.15 6.15.0 004.2 1.64c1.64.0 2.44-.76 2.44-1.56.0-2.48-8.08-.78-8.08-6.06.0-2.33 2-4.27 5.32-4.27a7.88 7.88.0 015.25 1.76.31.31.0 010 .43L12.9 19.65a.31.31.0 01-.45.05 6.08 6.08.0 00-3.84-1.32c-1.28.0-2 .57-2 1.41.0 2.23 8.06.74 8.06 6C14.67 28.33 12.84 30.27 9.05 30.27zM26.68 25.4a.27.27.0 01-.28.28H19a.09.09.0 00-.08.1 2.81 2.81.0 003 2.32 4.62 4.62.0 002.56-.84.27.27.0 01.4.06l.9 1.31a.28.28.0 01-.06.37 6.67 6.67.0 01-4.1 1.28 5.28 5.28.0 01-5.57-5.48 5.31 5.31.0 015.4-5.46c3.11.0 5.22 2.33 5.22 5.74z"/></svg></span></a><button class=navbar-toggler type=button data-toggle=collapse data-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=main_navbar><ul class="navbar-nav mr-4 mb-2 mb-lg-0 pl-4 pl-lg-2"><li class="nav-item mr-4 mb-2 mb-lg-0"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/ja/about>About Selenium</a>
<a class=dropdown-item href=/ja/project>Structure and Governance</a>
<a class=dropdown-item href=/ja/events>Events</a>
<a class=dropdown-item href=/ja/ecosystem>Ecosystem</a>
<a class=dropdown-item href=/ja/history>History</a>
<a class=dropdown-item href=/ja/getinvolved>Get Involved</a>
<a class=dropdown-item href=/ja/sponsors>Sponsors</a></div></li></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/ja/downloads><span>Downloads</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/ja/documentation><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/ja/projects><span>Projects</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/ja/support><span>Support</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/ja/blog><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/documentation/grid/>English</a>
<a class=dropdown-item href=/pt-br/documentation/grid/>Português (Brasileiro)</a>
<a class=dropdown-item href=/zh-cn/documentation/grid/>中文简体</a></div></li></ul><div class=navbar-nav><div id=docsearch></div></div></div></nav><section id=announcement-banner class="alert-static row -bg-selenium-blue"><div class=container style=padding:10px><div class="row justify-content-center"><div class="alert alert-selenium-blue col-12 fade show mb-0 p-0 -bg-selenium-blue" role=alert><h4 class="alert-heading text-center m-0">SeleniumConf Chicago 2023 is a wrap!
<a href="https://www.youtube.com/playlist?list=PLRdSclUtJDYXDEsWI0vwBmJxW17NgsaAk" target=_blank aria-pressed=true>Watch the Videos</a></h4></div></div></div></section></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>これは、このセクションの複数ページの印刷可能なビューです。
<a href=# onclick="return print(),!1">印刷するには、ここをクリックしてください</a>.</p><p><a href=/ja/documentation/grid/>このページの通常のビューに戻る</a>.</p></div><h1 class=title>Grid</h1><div class=lead>複数のマシンで並行してテストを実行したいですか？ Grid が手助けします。</div><ul><li>1: <a href=#pg-3c2b75d36f1614bda9b1f90fda16b57d>Gridを始める</a></li><li>2: <a href=#pg-0918ac00dadcaec8ed42334dbf603f55>いつGridを使用すべきか</a></li><li>3: <a href=#pg-456d2e951a458e6f18fe16c80ad70bc5>Serenium Grid のコンポーネント</a></li><li>4: <a href=#pg-6355fd8c1e3f7ed9dd004a69385e35a6>コンポーネントの構成</a></li><ul><li>4.1: <a href=#pg-12759b62a0129dd593b35c93c9ce349e>構成ヘルプ</a></li><li>4.2: <a href=#pg-4ed8bf1ae4585a0e8d21dbdfce81afb8>Selenium GridのCLI オプション</a></li><li>4.3: <a href=#pg-e617239c5efb3fbc97f69447f5ba5981>Toml オプション</a></li></ul><li>5: <a href=#pg-9c11ba83187c12a3cd6b4a1789bae031>Grid アーキテクチャ</a></li><li>6: <a href=#pg-abac6f77089fbf05fa24eca43aebeddf>高度な機能</a></li><ul><li>6.1: <a href=#pg-cff3310fa01f534cfe804c3e76ae9056>可観測性</a></li><li>6.2: <a href=#pg-b11540ed82255545d0e8201c6e111a70>GraphQLクエリのサポート</a></li><li>6.3: <a href=#pg-d62408233c3d62bcee1fef32842d1ecd>Grid エンドポイント</a></li><li>6.4: <a href=#pg-5b5dba3035d5fdea37ea443e04bc3675>Customizing a Node</a></li><li>6.5: <a href=#pg-e65991b592e30916d941bdbfabb53abe>External datastore</a></li></ul></ul><div class=content><p>Selenium Grid を利用して、クライアントからリモートブラウザーインスタンスにコマンドを
ルーティングし、リモートマシン上で WebDriver スクリプトを実行することができます。</p><p>Grid の目標は、</p><ul><li>複数のマシンでの並行したテスト実行を、簡単な方法で提供する</li><li>異なるバージョンのブラウザでのテストを可能にする</li><li>クロスプラットフォームテストを可能にする</li></ul><p>興味がありますか？
Grid の仕組みと設定方法が知りたければ以下のセクションを読んでください。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3c2b75d36f1614bda9b1f90fda16b57d>1 - Gridを始める</h1><div class=lead>Selenium Gridの導入方法</div><h2 id=クイックスタート>クイックスタート</h2><ol><li><p>事前条件</p><ul><li>Java 11 もしくはそれ以上がインストールされていること</li><li>ブラウザーがインストールされていること</li><li>ブラウザードライバー<ul><li>Selenium 4.6 を使用していれば、Chrome, Firefox, Edge ドライバーが <a href=/ja/documentation/webdriver/getting_started/install_drivers/#1-selenium-manager-beta><code>PATH</code> から見つからない場合</a> Selenium Manager がドライバーを設定します。</li><li><a href=/ja/documentation/webdriver/getting_started/install_drivers/#3-the-path-environment-variable><code>PATH</code> が通っているインストール済みのもの</a></li></ul></li><li><a href=https://github.com/SeleniumHQ/selenium/releases/latest>最新の</a> Selenium Server jar ファイルをダウンロードしていること</li></ul></li><li><p>Grid の起動</p><ul><li><code>java -jar selenium-server-&lt;version>.jar standalone</code></li></ul></li><li><p>あなたの WebDriver テストの対象を <a href=http://localhost:4444>http://localhost:4444</a> に向ける</p></li><li><p>(必要があれば) ブラウザで<a href=http://localhost:4444>http://localhost:4444</a>を開いて実行中のテストや利用可能な capabilities を確認する。</p></li></ol><p>さらにオプションを知りたい場合は以降のセクションに進んでください。</p><h2 id=grid-コンポーネントロール>Grid コンポーネントロール</h2><p>Grid は 6 つの異なる<a href=/ja/documentation/grid/components/>コンポーネント</a>で構成され、様々な方法でデプロイすることができます。</p><p>必要に応じて、それぞれ個別に起動する（分散）か、ハブ&ノードのグループに分けるか、
全てを一つのマシンで起動する（<strong>スタンドアロン</strong>）かを選べます。</p><h3 id=スタンドアロン><strong>スタンドアロン</strong></h3><p><strong>スタンドアロン</strong>は全ての Grid<a href=/ja/documentation/grid/components/>コンポーネント</a>を 1 つに連結します。
<strong>スタンドアロン</strong>モードはシングルプロセスで動き、Grid の全機能を利用することができます。
<strong>スタンドアロン</strong>は単一のマシン上でのみ動かすことができます。</p><p><strong>スタンドアロン</strong>は Selenium Grid を起動する最も簡単な方法でもあります。
デフォルトではサーバーは<a href=http://localhost:4444>http://localhost:4444</a> で <code>RemoteWebDriver</code> リクエストをリッスンします。
サーバーはデフォルトでシステム<a href=/ja/documentation/webdriver/getting_started/install_drivers/#3-the-path-environment-variable>パス</a>上の利用可能なドライバーを検出します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar standalone
</span></span></code></pre></div><p><strong>スタンドアロン</strong>で Grid のを起動したら、WebDriver テストの対象を<a href=http://localhost:4444>http://localhost:4444</a>に向けてください。</p><p><strong>スタンドアロン</strong>の一般的なユースケースは:</p><ul><li><code>RemoteWebDriver</code> を使用したローカルでの開発やデバッグ</li><li>コードをプッシュする前の簡易なテスト実行</li><li>CI/CD 向けの Grid のセットアップ(GitHub Actions, Jenkins など)</li></ul><h3 id=ハブノード>ハブ&ノード</h3><p><strong>ハブ&ノード</strong>は最も利用されているロールです。その理由は:</p><ul><li>様々なマシンを Grid に統合できます<ul><li>様々な OS やブラウザーバージョンを持つマシンなど</li></ul></li><li>WebDriver テストのエントリーポイントを持っています</li><li>Grid を停止せずにキャパシティのスケールアップ・ダウンが可能です</li></ul><h4 id=ハブ>ハブ</h4><p>ハブは以下の<a href=/ja/documentation/grid/components/>コンポーネント</a>で構成されています。
ルーター、ディストリビューター、セッションマップ、新規セッションキュー、イベントバス。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub
</span></span></code></pre></div><p>デフォルトでは、サーバーは<a href=http://localhost:4444>http://localhost:4444</a>にて <code>RemoteWebDriver</code> リクエストを待ち受けます。</p><h4 id=ノード>ノード</h4><p><strong>ノード</strong>は起動時にシステムの<a href=/ja/documentation/webdriver/getting_started/install_drivers/#3-the-path-environment-variable>パス</a>
が通っている利用可能なドライバーを検出します。</p><p>次のコマンドは<strong>ノード</strong>が<strong>ハブ</strong>と同じマシン上で動作していることを前提としています。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node
</span></span></code></pre></div><h5 id=同一マシン上での複数ノード>同一マシン上での複数ノード</h5><p>ノード 1</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --port <span style=color:#0000cf;font-weight:700>5555</span>
</span></span></code></pre></div><p>ノード 2</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --port <span style=color:#0000cf;font-weight:700>6666</span>
</span></span></code></pre></div><h5 id=異なるマシンでノードとハブを動かす>異なるマシンでノードとハブを動かす</h5><p><strong>ハブ</strong>と<strong>ノード</strong>は HTTP と<a href=/ja/documentation/grid/components/#event-bus><strong>イベントバス</strong></a>を介して通信します (<strong>イベントバス</strong>は<strong>ハブ</strong>の一部として存在します)。
<strong>ノード</strong>は<strong>イベントバス</strong>を通じてメッセージを送信し、登録処理を開始します。
<strong>ハブ</strong>がメッセージを受け取り、<strong>ノード</strong>の存在を確かめるため HTTP を使って<strong>ノード</strong>にアクセスします。</p><p><strong>ハブ</strong>がデフォルトのポートを使用していれば、 <code>--hub</code> フラグで<strong>ノード</strong>を登録することができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --hub http://&lt;hub-ip&gt;:4444
</span></span></code></pre></div><p><strong>ハブ</strong>がデフォルトのポートを使用していない場合、<code>--publish-events</code> と <code>--subscribe-events</code> のフラグが必要です。</p><p>例えば<strong>ハブ</strong>が <code>8886</code> <code>8887</code> <code>8888</code> ポートを利用している場合、</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub --publish-events tcp://&lt;hub-ip&gt;:8886 --subscribe-events tcp://&lt;hub-ip&gt;:8887 --port <span style=color:#0000cf;font-weight:700>8888</span>
</span></span></code></pre></div><p><strong>ノード</strong>はこれらのポートを登録する際に使用します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --publish-events tcp://&lt;hub-ip&gt;:8886 --subscribe-events tcp://&lt;hub-ip&gt;:8887
</span></span></code></pre></div><h3 id=分散>分散</h3><p>分散 Grid を利用すると、各コンポーネントは別々に起動され異なるマシン上で動作します。</p><div class="alert alert-primary" role=alert>コンポーネント間で通信をするために、全てのポートを適切に公開することが重要です。</div><ol><li><strong>イベントバス</strong>は Grid コンポーネント間での内部通信を可能にします。</li></ol><p>デフォルトポートは <code>4442</code>, <code>4443</code>, <code>5557</code> です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar event-bus --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --port <span style=color:#0000cf;font-weight:700>5557</span>
</span></span></code></pre></div><ol start=2><li><strong>新規セッションキュー</strong>は新規セッションリクエストをキューに積み、ディストリビューターがリクエストを取得できるようにします。</li></ol><p>デフォルトポートは <code>5559</code> です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span>
</span></span></code></pre></div><ol start=3><li><strong>セッションマップ</strong>はセッション ID とそのセッションが実行中の<strong>ノード</strong>のマップを持ちます。</li></ol><p>デフォルトの<strong>セッションマップ</strong>のポートは <code>5556</code> です。
<strong>セッションマップ</strong>は<strong>イベントバス</strong>と通信します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessions --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --port <span style=color:#0000cf;font-weight:700>5556</span>
</span></span></code></pre></div><ol start=4><li><strong>ディストリビューター</strong>は<strong>新規セッションキュー</strong>に新規セッションリクエストを問い合わせ、 capabilities がマッチする<strong>ノード</strong>にアサインします。<strong>ノード</strong>は、<strong>ハブ&ノード</strong>構成の Grid における<strong>ハブ</strong>の登録と同じように、<strong>ディストリビューター</strong>に登録します。</li></ol><p>デフォルトの<strong>ディストリビューター</strong>のポートは <code>5553</code> です。
<strong>ディストリビューター</strong>は<strong>新規セッションキュー</strong>、<strong>セッションマップ</strong>、<strong>イベントバス</strong>、<strong>ノード</strong>と通信します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar distributor --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --sessions http://&lt;sessions-ip&gt;:5556 --sessionqueue http://&lt;new-session-queue-ip&gt;:5559 --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span>
</span></span></code></pre></div><ol start=5><li><strong>ルーター</strong>は<strong>新規セッションリクエスト</strong>をキューに、既存セッションのリクエストをそのセッションが実行中の<strong>ノード</strong>に転送します。</li></ol><p>デフォルトの<strong>ルーター</strong>のポートは <code>4444</code> です。
<strong>ルーター</strong>は<strong>新規セッションキュー</strong>、<strong>セッションマップ</strong>、<strong>ディストリビューター</strong>と通信します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar router --sessions http://&lt;sessions-ip&gt;:5556 --distributor http://&lt;distributor-ip&gt;:5553 --sessionqueue http://&lt;new-session-queue-ip&gt;:5559 --port <span style=color:#0000cf;font-weight:700>4444</span>
</span></span></code></pre></div><ol start=6><li>ノード</li></ol><p>デフォルトの<strong>ノード</strong>のポートは <code>5555</code> です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443
</span></span></code></pre></div><h2 id=テストメタデータ>テストメタデータ</h2><p>テストにメタデータを追加して、<a href=/ja/documentation/grid/advanced_features/graphql_support/>GraphQL</a> 経由で使用するか、Selenium Grid UI 経由でその一部( <code>se:name</code> など) を可視化します。</p><p>メタデータは capability に<code>se:</code>プリフィックスをつけることで追加できます。
Java での簡単な例を紹介します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>ChromeOptions</span> <span style=color:#000>chromeOptions</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ChromeOptions</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>chromeOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;browserVersion&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;100&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>chromeOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;platformName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Windows&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Showing a test name instead of the session id in the Grid UI
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>chromeOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:name&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;My simple test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Other type of metadata can be seen in the Grid UI by clicking on the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// session info or via GraphQL
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>chromeOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:sampleMetadata&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Sample metadata value&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>WebDriver</span> <span style=color:#000>driver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>URL</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://gridUrl:4444&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>chromeOptions</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://www.google.com&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><h2 id=selenium-grid-のクエリ>Selenium Grid のクエリ</h2><p>Grid 起動後、ステータスを問い合わせる方法は、
Grid UI と API 呼び出しの主に 2 通りあります。</p><p>Grid UI は、お好みのブラウザで<a href=http://localhost:4444>http://localhost:4444</a>
にアクセスすることで見られます。</p><p>API 呼び出しは<a href=http://localhost:4444/status>http://localhost:4444/status</a>のエンドポイントか、
<a href=/ja/documentation/grid/advanced_features/graphql_support/>GraphQL</a>が利用できます。</p><div class="pageinfo pageinfo-primary"><p>このページで紹介するコマンドの例は、わかりやすくするために
コンポーネントがローカルで動作していると仮定しています。
より詳細な例と使用方法は<a href=/ja/documentation/grid/components/>コンポーネント</a>の章を参照してください。</p></div><h2 id=java-11-の-http-クライアントを利用する>Java 11 の HTTP クライアントを利用する</h2><p><a href=https://github.com/SeleniumHQ/selenium/releases/tag/selenium-4.5.0><span class=selenium-badge-version data-toggle=tooltip data-placement=right title="This code requires Selenium v4.5 or greater">Selenium v4.5</span></a></p><p>デフォルトでは Grid は<a href=https://github.com/AsyncHttpClient/async-http-client>AsyncHttpClient</a>を使用します。
AsyncHttpClient は Netty を使ったオープンソースのライブラリで、非同期での HTTP リクエストを実現します。
さらに WebSocket をサポートするため Grid に適しています。</p><p>しかし、AsyncHttpClient は 2021 年からあまり活発にメンテナンスされていません。
そして Java 11+ではビルトインの HTTP と WebSocket のクライアントを提供しています。
現在 Selenium はサポートする最小バージョンを Java11 にアップグレードする計画をしていますが、
それにはかなりの労力が必要です。メジャーリリースに合わせることはユーザー体験にとって重要です。</p><p>Java11 のクライアントを利用するには<code>selenium-http-jdk-client</code>jar ファイルをダウンロードし、
<code>--ext</code>フラグで Grid の jar のクラスパスに通す必要があります。</p><p>jar ファイルは<a href=https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-http-jdk-client/>repo1.maven.org</a>から直接ダウンロードできます。
Grid を起動する方法は以下の通りです:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -Dwebdriver.http.factory<span style=color:#ce5c00;font-weight:700>=</span>jdk-http-client -jar selenium-server-&lt;version&gt;.jar --ext selenium-http-jdk-client-&lt;version&gt;.jar standalone
</span></span></code></pre></div><p><code>selenium-http-jdk-client</code>をダウンロードする別の方法として<a href=https://get-coursier.io/docs/cli-installation>Coursier</a>を使う方法があります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -Dwebdriver.http.factory<span style=color:#ce5c00;font-weight:700>=</span>jdk-http-client -jar selenium-server-&lt;version&gt;.jar --ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-http-jdk-client:&lt;version&gt;<span style=color:#204a87;font-weight:700>)</span> standalone
</span></span></code></pre></div><p>ハブ&ノードか分散モードで動かす場合、<code>-Dwebdriver.http.factory=jdk-http-client</code>と
<code>--ext</code>フラグの設定が各コンポーネントに必要になります。</p><h2 id=grid-サイズ>Grid サイズ</h2><p>Grid ロールの選択は、どのような OS やブラウザをサポートする必要があるかによって決まります。
どの OS、ブラウザをサポートするか、どのくらいの並列セッションを実行するか、マシンの数とそれらの性能（CPU、RAM）に依存します。</p><p>セッションを並列で作成するのは、<strong>ディストリビューター</strong>が利用可能なプロセッサーに依存します。たとえば、
マシンに 4 つの CPU がある場合、<strong>ディストリビューター</strong>は同時に最大 4 つのセッションしか作成できません。</p><p>デフォルトでは、ノードがサポートする同時セッションの最大数は、利用可能な CPU の数によって制限されます。
たとえば、ノードのマシンに 8CPU がある場合、同時に最大 8 つのブラウザセッションを実行できます（ただし、Safari は常に 1 つです）。
また各ブラウザセッションは約 1GB の RAM を使用することが期待されます。</p><p>一般的にノードはできるだけ小さくすることが推奨されます。32CPU と 32GB の RAM を持つマシンで
32 の同時ブラウザセッションを実行するよりも、 32 の小さな プロセスをよりよく分離するために、
32 の小さなノードを持つことが推奨されます。これによって、もしノードに障害が発生しても、分離されて処理されます。
Docker はこの方法を実現するための優れたツールです。</p><p>デフォルト値(ブラウザあたり 1CPU/1GB RAM)は推奨値であり、あなたの用途に沿わない可能性があることに注意してください。
この値は参考値としての推奨であり、継続的にパフォーマンスを測定することで、あなたの環境にとって理想的な値を見つけることができるでしょう。</p><p>Grid のサイズは、サポートされる同時セッションの数と、ノードの数に関連しており、
万能なサイズというものはありません。以下のサイズは概算で、環境が違えば変わる可能性があります。
例えば、120 台のノードを持つハブ&ノードの場合、ハブが十分なリソースを持っていればうまく機能するかもしれません。
また、この数値は確定したものではありません。フィードバックをお待ちしています。</p><h3 id=small>Small</h3><p>5 台以下の<strong>ノード</strong>で、<strong>スタンドアロン</strong>か<strong>ハブ&ノード</strong></p><h3 id=middle>Middle</h3><p>6〜60 台の<strong>ノード</strong>で、<strong>ハブ&ノード</strong></p><h3 id=large>Large</h3><p>60〜100 台の<strong>ノード</strong>で、<strong>ハブ&ノード</strong>、あるいは 100 台以上の<strong>ノード</strong>で<strong>分散</strong></p><h2 id=警告>警告</h2><p>Grid を保護しないと、以下のような問題が発生する可能性があります。</p><ul><li>Grid インフラストラクチャへのオープンアクセスを許容してしまう。</li><li>サードパーティが内部 Web アプリケーションやファイルにアクセスすることを許可してしまう。</li><li>サードパーティにカスタムバイナリの実行を許可してしまう。</li></ul><p><a href=//labs.detectify.com>Detectify</a> のブログで公開されてしまった Grid が
どのように悪用されるかを紹介しています: <a href=//labs.detectify.com/2017/10/06/guest-blog-dont-leave-your-grid-wide-open/>Don&rsquo;t Leave your Grid Wide Open</a></p><h2 id=参考文献>参考文献</h2><ul><li><a href=/ja/documentation/grid/components/>Components</a>: 内部のコンポーネントの仕組みを知る</li><li><a href=/ja/documentation/grid/configuration/>Configuration</a>: Grid の設定をカスタマイズする</li><li><a href=/ja/documentation/grid/architecture/>Architecture</a>: Grid のコンセプトを理解する</li><li><a href=/ja/documentation/grid/advanced_features/>Advanced Features</a>: Grid のさらなる可能性を探る</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0918ac00dadcaec8ed42334dbf603f55>2 - いつGridを使用すべきか</h1><div class=lead>Gridがあなたにとって最適なツールでしょうか？</div><p>Grid をいつ使うべきでしょうか？</p><ul><li>複数のブラウザー、異なるタイプまたは異なるバージョンのブラウザー、あるいは異なる OS 上でで実行されているブラウザーに対して並列でテストを実行したい場合</li><li>テストスイートの実行時間を減らしたい場合</li></ul><p>Selenium Grid はノードと呼ばれる複数のマシンを使用して並列でテストスイートを実行します。
大規模な長時間実行されるテストでは数分から数時間、あるいは数日単位での短縮が可能です。
つまり、あなたのテスト対象のアプリケーションのテスト結果を得るまでの時間を短縮します。</p><p>Grid は複数の異なるブラウザーに対してテストを実行でき、また同じブラウザーインスタンスに対して複数のテストを実行することも可能です。
たとえば 6 つのノードで構成された Grid があるとします。
最初のマシンは FireFox の最新バージョン、2 つめは FireFox の最新から一つ前のバージョン、
3 つめは 最新の Chrome、そして残りは Mac Mini で最新の Safari を使って 3 つのテストを並行して実行することができます。</p><p>実行時間は簡単な式で表すことができます:</p><p><code>テストの数 * 平均テスト時間 / ノード数 = 合計実行時間</code></p><pre><code>   15      *       45s        /        1        =      11m 15s   // Grid なし
   15      *       45s        /        5        =      2m 15s    // 5 ノードの Grid
   15      *       45s        /        15       =      45s       // 15 ノードの Grid
  100      *       120s       /        15       =      13m 20s   // Grid なしの場合3時間以上かかります
</code></pre><p>テストスイートが実行されると Grid はテストで設定されたブラウザに対して実行するテストを割り当てます。</p><p>このような設定により、大規模な Selenium テストスイートであっても実行時間を大幅に短縮することができます。</p><p>Selenium Grid は Selenium プロジェクトの一部であり、
Selenium コアの開発コミッターと同じチームによってメンテナンスされています。
テストの実行速度の重要性を認識し、Grid は Selenium プロジェクトの初期段階から重要な役割を担っています。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-456d2e951a458e6f18fe16c80ad70bc5>3 - Serenium Grid のコンポーネント</h1><div class=lead>Grid コンポーネントの使い方について</div><p>Selenium Grid 4 は以前のバージョンから一新し、全面的に作り直されました。
全体的なパフォーマンスの改善と標準の準拠に加え、より現代的なコンピューティングとソフトウェア開発
に適応するために機能ごとに分割されました。
コンテナ化とクラウド上での分散スケーラビリティのために構築された、現代に適した全く新しいソリューションです。</p><div class="td-card card mb-4"><div class=card-header><strong>Grid Components</strong></div><div class=card-body><p class=card-text><img src=/images/documentation/grid/components.png alt="Selenium Grid 4 Components" title="Selenium Grid 4 Components"></p></div><div class=card-footer>完全分散型モードでのGridコンポーネント</div></div><h2 id=ルーター>ルーター</h2><p>これは Grid のエントリポイントであり、すべての外部リクエストを受信し正しいコンポーネントへルーティングします。</p><p><strong>ルーター</strong>が<strong>新規セッションリクエスト</strong>を受信すると、<strong>新規セッションキュー</strong>に転送します。</p><p>リクエストが既存のセッションのものである場合、<strong>ルーター</strong>は<strong>セッションマップ</strong>に、
セッションが実行されている <strong>ノード</strong> ID の取得を要求します。そして<strong>ノード</strong>にリクエストを直接転送します。</p><p><strong>ルーター</strong>は、リクエストをより処理能力の高いコンポーネントに負荷を分散させます。
この負荷分散処理自体もコンポーネントに不必要に負荷をかけることはありません。</p><h2 id=ディストリビューター>ディストリビューター</h2><p><strong>ディストリビューター</strong>の主な責務は 2 つあります:</p><h4 id=すべてのノードとその-capabilities-を登録し追跡します>すべてのノードとその capabilities を登録し追跡します</h4><p><strong>イベントバス</strong>を通じて<strong>ノード</strong>登録イベントを贈ることで<strong>ノード</strong>を<strong>ディストリビューター</strong>に登録します。
<strong>ディストリビューター</strong>はそのイベントを受けて<strong>ノード</strong>の存在を HTTP リクエストで確認します。
リクエストが成功した場合、<strong>ディストリビューター</strong>は<strong>ノード</strong>を登録し、<strong>Grid モデル</strong>を通じて追跡を開始します。</p><h4 id=保留中の新規セッションリクエストを処理する>保留中の新規セッションリクエストを処理する</h4><p>新規セッションリクエストが<strong>ルーター</strong>に送信されると、リクエストは<strong>新規セッションキュー</strong>に転送されます。
<strong>ディストリビューター</strong>は<strong>新規セッションキュー</strong>をポーリングし、保留中の新規セッションリクエストを見つけると、
セッションが作成可能な<strong>ノード</strong>を探します。 セッションが作成されると<strong>ディストリビューター</strong>は
セッション ID とセッションが実行される<strong>ノード</strong>の紐付けを<strong>セッションマップ</strong>に保存します。</p><h2 id=セッションマップ>セッションマップ</h2><p><strong>セッションマップ</strong>はセッション ID とセッションが実行されている<strong>ノード</strong>の紐付けを保存します。
これにより<strong>ルーター</strong>がリクエストを<strong>ノード</strong>に転送できるようにします。
<strong>ルーター</strong>は<strong>セッションマップ</strong>にセッション ID に紐づく<strong>ノード</strong>を問い合わせます。</p><h2 id=新規セッションキュー>新規セッションキュー</h2><p><strong>新規セッションキュー</strong>はすべての新規セッションリクエストを FIFO 順で保持します。
リクエストのタイムアウトとリトライ間隔の設定が可能です。</p><p><strong>ルーター</strong>は新規セッションリクエストを<strong>新規セッションキュー</strong>に追加し、レスポンスを待ちます。
<strong>新規セッションキュー</strong>は定期的にキュー内のリクエストがタイムアウトしていないかをチェックし、
タイムアウトしたリクエストがあればリクエストを拒否しキューから取り除きます。</p><p><strong>ディストリビューター</strong>はスロットに空きがあるかを定期的にチェックします。
もし空きがあれば、<strong>新規セッションキュー</strong>から最初にマッチするリクエストを取り出し、
新規セッションの作成を試みます。</p><p>リクエストされた capabilities にマッチする空き<strong>ノード</strong>スロットがあれば、
<strong>ディストリビューター</strong>は空きスロットの確保を試みます。全てのスロットがビジーだった場合、
<strong>ディストリビューター</strong>はリクエストをキューに戻します。
リトライ中やキューに戻す最中にリクエストがタイムアウトした場合リクエストは拒否されます。</p><p>セッションの作成に成功すると、<strong>ディストリビューター</strong>はセッションの情報を<strong>新規セッションキュー</strong>に送信し、
これが<strong>ルーター</strong>へのレスポンスとして送信され、最終的にクライアントに返ります。</p><h2 id=ノード>ノード</h2><p>Grid は複数の<strong>ノード</strong>を持つことができます。
<strong>ノード</strong>は、各<strong>ノード</strong>が実行されているマシン上の利用可能なブラウザのスロットを管理します。</p><p><strong>ノード</strong>は、<strong>イベントバス</strong>を介して自身を<strong>ディストリビューター</strong>に登録します。
構成情報は登録メッセージの一部として送信されます。</p><p>デフォルトでは、<strong>ノード</strong>はマシンのパス上に存在する全てのブラウザドライバーを自動で登録します。
また FireFox と Chromium ベースブラウザの場合、CPU1 つにつき 1 スロットを作成します。
Safari の場合は 1 つのスロットのみ作成します。
<a href=/ja/documentation/grid/configuration/>特定の設定によって</a>セッションを Docker コンテナで実行したり、コマンドを中継したりすることも可能です。</p><p><strong>ノード</strong>は受信したコマンドを実行するだけで、コマンドの評価・判断や、フロー制御以外の制御は行いません。
<strong>ノード</strong>が実行されているマシンは、他のコンポーネントと同じ OS を持つ必要はありません。
たとえば、Windows <strong>ノード</strong>には IE Mode on Edge をブラウザーオプションとして提供する機能がありますが、
これは Linux または Mac では不可能です。
Grid は 複数の Windows, Mac, Linux <strong>ノード</strong>で構成することが可能です。</p><h2 id=イベントバス>イベントバス</h2><p><strong>イベントバス</strong>は<strong>ノード</strong>、<strong>ディストリビューター</strong>、セッションキュー、<strong>セッションマップ</strong>間の通信経路として機能します。
Grid は内部通信のほとんどをメッセージで行うことで、負荷の高い HTTP 呼び出しを避けています。
分散モードで Grid を起動する場合、<strong>イベントバス</strong>は最初に起動されるべきコンポーネントです。</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Gridを動かす</h4>これらのコンポーネントを使って Grid を実行してみたいですか？
<a href=/ja/documentation/grid/getting_started/>&ldquo;Grid を始める&rdquo;</a> でどのように設定するか見ることができます。</div></div><div class=td-content style=page-break-before:always><h1 id=pg-6355fd8c1e3f7ed9dd004a69385e35a6>4 - コンポーネントの構成</h1><div class=lead>ここでは、各コンポーネントを、共通の設定とコンポーネント固有の設定で個別に設定する方法を確認できます。</div></div><div class=td-content><h1 id=pg-12759b62a0129dd593b35c93c9ce349e>4.1 - 構成ヘルプ</h1><div class=lead>Gridの設定に利用可能なオプション</div><div class="pageinfo pageinfo-primary"><p>ヘルプコマンドは、現在のコード実装に基づいて情報を表示します。
したがって、ドキュメントが更新されない場合に備えて、正確な情報を提供します。
それは、新しいバージョンのグリッド 4 の構成について学習する最も簡単な方法です。</p></div><h2 id=info-コマンド>Info コマンド</h2><p>info コマンドは、次のトピックに関する詳細なドキュメントを提供します。</p><ul><li>Selenium の構成</li><li>セキュリティ</li><li>セッションマップの設定</li><li>トレース</li></ul><h3 id=構成ヘルプ>構成ヘルプ</h3><p>クイック設定のヘルプと概要は、以下を実行することで提供されます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info config
</span></span></code></pre></div><h3 id=セキュリティ>セキュリティ</h3><p>安全な通信とノード登録のためのグリッドサーバーの設定の詳細を取得するには、以下を実行します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info security
</span></span></code></pre></div><h3 id=セッションマップの設定>セッションマップの設定</h3><p>デフォルトでは、グリッドはローカルセッションマップを使用してセッション情報を保存します。
グリッドは、Redis や JDBC-SQL がサポートするデータベースなどの追加のストレージオプションをサポートしています。
別のセッションストレージをセットアップするには、次のコマンドを使用してセットアップ手順を取得します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info sessionmap
</span></span></code></pre></div><h3 id=opentelemetry-と-jaeger-を使用したトレースの設定>OpenTelemetry と Jaeger を使用したトレースの設定</h3><p>デフォルトでは、トレースは有効になっています。
トレースをエクスポートして Jaeger 経由で視覚化するには、次のコマンドを使用して手順を実行します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info tracing
</span></span></code></pre></div><h2 id=seleniumgrid-コマンドを一覧表示する>SeleniumGrid コマンドを一覧表示する</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar --config-help
</span></span></code></pre></div><p>使用可能なすべてのコマンドとそれぞれの説明が表示されます。</p><h2 id=コンポーネントヘルプコマンド>コンポーネントヘルプコマンド</h2><p>Selenium ロールの後に–help config オプションを渡して、コンポーネント固有の構成情報を取得します。</p><h3 id=スタンドアロン>スタンドアロン</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar standalone --help
</span></span></code></pre></div><h3 id=ハブ>ハブ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub --help
</span></span></code></pre></div><h3 id=セッション>セッション</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessions --help
</span></span></code></pre></div><h3 id=新規セッションキュー>新規セッションキュー</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessionqueue --help
</span></span></code></pre></div><h3 id=ディストリビューター>ディストリビューター</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar distributor --help
</span></span></code></pre></div><h3 id=ルーター>ルーター</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar router --help
</span></span></code></pre></div><h3 id=ノード>ノード</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --help
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4ed8bf1ae4585a0e8d21dbdfce81afb8>4.2 - Selenium GridのCLI オプション</h1><div class=lead>全てのGridコンポーネントのCLIオプション詳細</div><p>Grid の設定には、さまざまなセクションが用意されています。
各セクションには、コマンドライン引数で設定可能なオプションがあります。コマンドライン引数で設定できます。</p><p>コンポーネントとセクションの対応は以下の通りです。</p><div class="pageinfo pageinfo-primary"><p>オプションが変更、または追加されたが文書化されていない場合、
このドキュメントは古くなる可能性があることに注意してください。
もしそのような状況を見つけたら、<a href=/ja/documentation/grid/configuration/help/>&ldquo;構成ヘルプ&rdquo;</a>を確認し、
ドキュメントを更新するプルリクエストを気軽に送ってください。</p></div><h2 id=セクション>セクション</h2><table class="table table-bordered text-md-center d-md-table-cell"><thead><tr><th></th><th>スタンドアロン</th><th>ハブ</th><th>ノード</th><th>ディストリビューター</th><th>ルーター</th><th>セッション</th><th>新規セッションキュー</th></tr></thead><tbody><tr><th><a href=#distributor>Distributor</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#docker>Docker</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#events>Events</a></th><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#logging>Logging</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#network>Network</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#node>Node</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#router>Router</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#relay>Relay</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#server>Server</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#sessionqueue>SessionQueue</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#sessions>Sessions</a></th><td></td><td></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td></tr></tbody></table><h3 id=distributor>Distributor</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--healthcheck-interval</code></td><td>int</td><td><code>120</code></td><td>全てのノードに対してヘルスチェックを実行する頻度（秒）を指定します。これにより、サーバーは全てのノードに対して正常に ping を送信できるようになります。</td></tr><tr><td><code>--distributor</code></td><td>uri</td><td><code>http://localhost:5553</code></td><td>ディストリビューターの URL。</td></tr><tr><td><code>--distributor-host</code></td><td>string</td><td><code>localhost</code></td><td>ディストリビューターがリッスンするホスト名。</td></tr><tr><td><code>--distributor-implementation</code></td><td>string</td><td><code>org.openqa.selenium.grid.distributor.local.LocalDistributor</code></td><td>デフォルトでないディストリビューター実装の完全なクラス名。</td></tr><tr><td><code>--distributor-port</code></td><td>int</td><td><code>5553</code></td><td>ディストリビューターがリッスンするポート番号。</td></tr><tr><td><code>--reject-unsupported-caps</code></td><td>boolean</td><td><code>false</code></td><td>Grid がサポートしていない capabilities をリクエストされた時、ディストリビューターがリクエストを即座に今日できるようにします。これはオンデマンドでノードを立ち上げをしない Grid の設定に適しています。</td></tr><tr><td><code>--slot-matcher</code></td><td>string</td><td><code>org.openqa.selenium.grid.data.DefaultSlotMatcher</code></td><td>デフォルト以外で使用するスロットマッチャーの完全なクラス名。これはノードが特定のセッションをサポートできるかを判断するために使用されます。</td></tr><tr><td><code>--slot-selector</code></td><td>string</td><td><code>org.openqa.selenium.grid.distributor.selector.DefaultSlotSelector</code></td><td>デフォルト以外のスロットセレクターの完全なクラス名。これは、ノードがマッチした後ノード内のスロットを選択するために使用されます。</td></tr></tbody></table><h3 id=docker>Docker</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--docker-assets-path</code></td><td>string</td><td><code>/opt/selenium/assets</code></td><td>アセットが保存される絶対パス。</td></tr><tr><td><code>--docker-</code></td><td>string[]</td><td><code>selenium/standalone-firefox:latest '{"browserName": "firefox"}'</code></td><td>イメージとステレオタイプの capabilities を対応付ける Docker 設定 (例 `-D selenium/standalone-firefox:latest &lsquo;{&ldquo;browserName&rdquo;: &ldquo;firefox&rdquo;}&rsquo;)</td></tr><tr><td><code>--docker-devices</code></td><td>string[]</td><td><code>/dev/kvm:/dev/kvm</code></td><td>コンテナに対してデバイスを公開します。各デバイスマッピングは、ホストとコンテナの両方のデバイスへのパスを、コロンで区切って保つ必要があります。例: /device/path/in/host:/device/path/in/container</td></tr><tr><td><code>--docker-host</code></td><td>string</td><td><code>localhost</code></td><td>Docker デーモンが動作しているホスト名。</td></tr><tr><td><code>--docker-port</code></td><td>int</td><td><code>2375</code></td><td>Docker デーモンが動作しているポート名。</td></tr><tr><td><code>--docker-url</code></td><td>string</td><td><code>http://localhost:2375</code></td><td>Docker デーモンに接続するための URL。</td></tr><tr><td><code>--docker-video-image</code></td><td>string</td><td><code>selenium/video:latest</code></td><td>ビデオレコーディングが有効になっているときに利用される Docker イメージ。</td></tr></tbody></table><h3 id=events>Events</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--bind-bus</code></td><td>boolean</td><td><code>false</code></td><td>接続をバインドするかコネクトするかを指定します。<br>true の場合、コンポーネントはイベントバスにバインドされます（イベントバスもコンポーネントによって起動されます、通常はディストリビューターとハブによって起動されます）。<br>false の場合、コンポーネントがイベントバスにコネクトします。</td></tr><tr><td><code>--events-implementation</code></td><td>string</td><td><code>org.openqa.selenium.events.zeromq.ZeroMqEventBus</code></td><td>デフォルトでないイベントバス実装の完全なクラス名。</td></tr><tr><td><code>--publish-events</code></td><td>string</td><td><code>tcp://*:4442</code></td><td>イベントをイベントバスに配信するための接続文字列。</td></tr><tr><td><code>--subscribe-events</code></td><td>string</td><td><code>tcp://*:4443</code></td><td>イベントをイベントバスから購読するための接続文字列。</td></tr></tbody></table><h3 id=logging>Logging</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--http-logs</code></td><td>boolean</td><td><code>false</code></td><td>http ログを有効にします。http ログを記録するには、トレースを有効にする必要があります。</td></tr><tr><td><code>--log-encoding</code></td><td>string</td><td><code>UTF-8</code></td><td>ログのエンコーディング。</td></tr><tr><td><code>--log</code></td><td>string</td><td>Windows パスの例:<br><code>'\path\to\file\gridlog.log'</code><br>or<br><code>'C:\path\path\to\file\gridlog.log'</code><br><br>Linux/Unix/MacOS パスの例:<br><code>'/path/to/file/gridlog.log'</code></td><td>ログを出力するファイル。OS のファイルパスと互換性があることを確認してください。</td></tr><tr><td><code>--log-level</code></td><td>string</td><td><code>“INFO”</code></td><td>ログレベル。デフォルトは INFO です。 ログレベルはこちらを参照してください。 <a href=https://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html>https://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html</a></td></tr><tr><td><code>--plain-logs</code></td><td>boolean</td><td><code>true</code></td><td>プレーンなログを使用します。</td></tr><tr><td><code>--structured-logs</code></td><td>boolean</td><td><code>false</code></td><td>構造化ログを使用します。</td></tr><tr><td><code>--tracing</code></td><td>boolean</td><td><code>true</code></td><td>トレースを有効にします。</td></tr><tr><td><code>--log-timestamp-format</code></td><td>string</td><td><code>HH:mm:ss.SSS</code></td><td>ログのタイムスタンプ形式を設定できます。</td></tr></tbody></table><h3 id=network>Network</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--relax-checks</code></td><td>boolean</td><td><code>false</code></td><td>受信リクエストのオリジンヘッダーとコンテンツタイプに対する、厳格な W3C 準拠の検証をを緩和します。</td></tr></tbody></table><h3 id=node>Node</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--detect-drivers</code></td><td>boolean</td><td><code>true</code></td><td>現在のシステム上で利用可能なドライバーを自動で検出してノードに追加します。</td></tr><tr><td><code>--driver-configuration</code></td><td>string[]</td><td><code>display-name="Firefox Nightly" max-sessions=2 webdriver-path="/usr/local/bin/geckodriver" stereotype='{"browserName": "firefox", "browserVersion": "86", "moz:firefoxOptions": {"binary":"/Applications/Firefox Nightly.app/Contents/MacOS/firefox-bin"}}'</code></td><td>ノードがサポートするドライバーの一覧。可読性向上のため TOML ファイルで設定することを推奨します。</td></tr><tr><td><code>--driver-factory</code></td><td>string[]</td><td><code>org.openqa.selenium.example.LynxDriverFactory '{"browserName": "lynx"}'</code></td><td>完全修飾クラス名と、そのクラスが対応するブラウザの設定とのマッピング。</td></tr><tr><td><code>--driver-implementation</code></td><td>string[]</td><td><code>"firefox"</code></td><td>チェックされるドライバー。指定された場合、自動設定はスキップされます。</td></tr><tr><td><code>--node-implementation</code></td><td>string</td><td><code>"org.openqa.selenium.grid.node.local.LocalNodeFactory"</code></td><td>デフォルトでないノード実装の完全なクラス名。これはセッションのライフサイクルを管理するために使用されます。</td></tr><tr><td><code>--grid-url</code></td><td>string</td><td><code>https://grid.example.com</code></td><td>Grid 全体のパブリックな URL (通常ハブかルーターのアドレスです)。</td></tr><tr><td><code>--heartbeat-period</code></td><td>int</td><td><code>60</code></td><td>ノードが生存していることを知らせるため、ノードがディストリビューターに送るハードビートを、どのくらいの頻度（秒）で送るか。</td></tr><tr><td><code>--max-sessions</code></td><td>int</td><td><code>8</code></td><td>最大同時接続セッション数。デフォルトは利用可能なプロセッサーの数です。</td></tr><tr><td><code>--override-max-sessions</code></td><td>boolean</td><td><code>false</code></td><td>利用可能なプロセッサーの数は、推奨される最大セッション数（プロセッサーごとに 1 つのブラウザセッション）です。このフラグを true に設定すると、推奨される最大値を上書きすることができます。セッションの安定性と信頼性が損なわれ、ホストがリソースを使い果たす可能性があります。</td></tr><tr><td><code>--register-cycle</code></td><td>int</td><td><code>10</code></td><td>ノードがディストリビューターに初回登録を試みる頻度(秒)。</td></tr><tr><td><code>--register-period</code></td><td>int</td><td><code>120</code></td><td>ノードが初めてディストリビューターに初回登録を試みるのにかかる時間(秒)。この時間が経過すると、ノードは再登録を試みない。</td></tr><tr><td><code>--session-timeout</code></td><td>int</td><td><code>300</code></td><td>X をセッションタイムアウト(秒)としたとき、 ノード は、過去 X 秒間に何の活動もなかったセッションを自動的に終了させます。 これにより他のテストが利用できるようスロットを解放します。</td></tr><tr><td><code>--vnc-env-var</code></td><td>string</td><td><code>START_XVFB</code></td><td>VNC ストリームが利用可能かどうかを判断するために利用する環境変数。</td></tr><tr><td><code>--no-vnc-port</code></td><td>int</td><td><code>7900</code></td><td>VNC が利用可能な場合、ローカルの noVNC ストリームを取得できるポートを設定します。</td></tr><tr><td><code>--drain-after-session-count</code></td><td>int</td><td><code>1</code></td><td>X 個のセッションが実行された後に、ノードをドレインしてシャットダウンします。 Kubernetes のような環境で有用です。 0 より大きい値を指定すると、この機能が有効になります。</td></tr><tr><td><code>--hub</code></td><td>string</td><td><code>http://localhost:4444</code></td><td>ハブ・ノード構成におけるハブのアドレスを指定します。ホスト名か IP アドレスが指定できます。この場合、ハブは <code>http://hostname:4444</code> とみなされ、 <code>--grid-url</code> は同じものになります。 <code>--publish-events</code> は <code>tcp://hostname:4442</code> 、<code>--subscribe-events</code> は <code>tcp://hostname:4443</code> となります。 <code>hostname</code> にポート番号が含まれている場合は、それが <code>--grid-url</code> に使用されますが、イベントバスの URI は変更されません。これらのデフォルト値は、適切なフラグを設定することでオーバーライドすることができます。ホスト名にプロトコル(<code>https</code>のような)が含まれる場合もそれが利用されます。</td></tr><tr><td><code>--enable-cdp</code></td><td>boolean</td><td><code>true</code></td><td>Grid 内で CDP プロキシーを有効にします。もしネットワークが web socket を許可していない場合、Grid 管理者は CDP を無効にできます。デフォルトは true です。</td></tr><tr><td><code>--enable-managed-downloads</code></td><td>boolean</td><td><code>false</code></td><td>This causes the Node to auto manage files downloaded for a given session on the Node.</td></tr><tr><td><code>--selenium-manager</code></td><td>boolean</td><td><code>false</code></td><td>When drivers are not available on the current system, use Selenium Manager. False by default.</td></tr></tbody></table><h3 id=relay>Relay</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--service-url</code></td><td>string</td><td><code>http://localhost:4723</code></td><td>Appium サーバーやクラウドサービスなど、WebDriver コマンドをサポートするサービスに接続するための URL です。</td></tr><tr><td><code>--service-host</code></td><td>string</td><td><code>localhost</code></td><td>WebDriver コマンドをサポートしてるサービスが稼働しているホスト名。</td></tr><tr><td><code>--service-port</code></td><td>int</td><td><code>4723</code></td><td>WebDriver コマンドをサポートしてるサービスが稼働しているポート番号。</td></tr><tr><td><code>--service-status-endpoint</code></td><td>string</td><td><code>/status</code></td><td>WebDriver サービスの状態を問い合わせるエンドポイント、オプショナルです。HTTP 200 レスポンスが期待されます。</td></tr><tr><td><code>--service-configuration</code></td><td>string[]</td><td><code>max-sessions=2 stereotype='{"browserName": "safari", "platformName": "iOS", "appium:platformVersion": "14.5"}}'</code></td><td>呼び出しの中継先となるサービスの設定。可読性向上のため、TOML ファイルで設定することを推奨します。</td></tr></tbody></table><h3 id=router>Router</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--password</code></td><td>string</td><td><code>myStrongPassword</code></td><td>クライアントがサーバーに接続する際に使用するパスワード。このパスワードとユーザー名の両方が設定されていないと使用できません。</td></tr><tr><td><code>--username</code></td><td>string</td><td><code>admin</code></td><td>クライアントがサーバーに接続する際に使用するユーザー名。このユーザー名とパスワードの両方が設定されていないと使用できません。</td></tr></tbody></table><h3 id=server>Server</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--allow-cors</code></td><td>boolean</td><td><code>true</code></td><td>Selenium サーバーが任意のホストからのウェブブラウザ接続を許可するかどうか。</td></tr><tr><td><code>--host</code></td><td>string</td><td><code>localhost</code></td><td>サーバーの IP もしくはホスト名、通常自動的に決定されます。</td></tr><tr><td><code>--bind-host</code></td><td>boolean</td><td><code>true</code></td><td>サーバがホストアドレス/ホスト名にバインドするか、あるいは到達可能な URL を知らせるためだけに使用するかを指定します。複雑なネットワーク構成で、サーバが現在の IP やホスト名ではなく、 外部の IP やホスト名で自分自身を公開する場合に有用です (例: Docker コンテナ内)。</td></tr><tr><td><code>--https-certificate</code></td><td>path</td><td><code>/path/to/cert.pem</code></td><td>HTTPS のためのサーバー証明書。詳細は &ldquo;java -jar selenium-server.jar info security&rdquo; を実行してください。</td></tr><tr><td><code>--https-private-key</code></td><td>path</td><td><code>/path/to/key.pkcs8</code></td><td>HTTPS のための秘密鍵。 詳細は &ldquo;java -jar selenium-server.jar info security&rdquo; を実行してください。</td></tr><tr><td><code>--max-threads</code></td><td>int</td><td><code>24</code></td><td>リスナースレッドの最大数。デフォルトは、有効なプロセッサーの * 3 です。</td></tr><tr><td><code>--port</code></td><td>int</td><td><code>4444</code></td><td>リッスンポート。このパラメータは異なるコンポーネントによって使用されるため、デフォルトはありません。例えば、ルータ/ハブ/スタンドアロンは 4444 を使用し、ノードは 5555 を使用します。</td></tr></tbody></table><h3 id=sessionqueue>SessionQueue</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--sessionqueue</code></td><td>uri</td><td><code>http://localhost:1237</code></td><td>新規セッションキューサーバーのアドレス。</td></tr><tr><td><code>-sessionqueue-host</code></td><td>string</td><td><code>localhost</code></td><td>新規セッションキューがリッスンするホスト。</td></tr><tr><td><code>--sessionqueue-port</code></td><td>int</td><td><code>1234</code></td><td>新規セッションキューがリッスンするポート</td></tr><tr><td><code>--session-request-timeout</code></td><td>int</td><td><code>300</code></td><td>タイムアウト(秒)。 新規セッションリクエストはキューに追加され、設定された時間以上キューに残っているリクエストはタイムアウトします。</td></tr><tr><td><code>--session-retry-interval</code></td><td>int</td><td><code>5</code></td><td>リトライ間隔(秒)。すべてのスロットがビジーな場合、 新規セッションリクエストはこの時間の間隔をおいてからリトライされます。</td></tr></tbody></table><h3 id=sessions>Sessions</h3><table><thead><tr><th>オプション</th><th>型</th><th>値/例</th><th>概要</th></tr></thead><tbody><tr><td><code>--sessions</code></td><td>uri</td><td><code>http://localhost:1234</code></td><td>セッションマップサーバーのアドレス。</td></tr><tr><td><code>--sessions-host</code></td><td>string</td><td><code>localhost</code></td><td>セッションマップサーバーがリッスンするホスト。</td></tr><tr><td><code>--sessions-port</code></td><td>int</td><td><code>1234</code></td><td>セッションマップサーバーがリッスンするポート。</td></tr></tbody></table><h2 id=設定例>設定例</h2><p>上記のオプションはすべて、Grid コンポーネントを起動する際に使用することができます。
Grid の適切な設定を模索するのに利用してください。</p><div class="pageinfo pageinfo-primary"><p><a href=/ja/documentation/grid/configuration/toml_options/>TOML ファイル</a> を使用して Grid を設定することをおすすめします。
設定ファイルは読みやすく、コード管理できます。</p><p>必要に応じて TOML ファイルと CLI オプションを併用することができます。</p></div><h3 id=コマンドラインフラグ>コマンドラインフラグ</h3><p>コマンドラインフラグとしてオプションを渡すには、適切なコンポーネントを特定し以下のテンプレートのようにします。</p><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar &lt;component&gt; --&lt;option&gt; value
</code></pre><h4 id=スタドアロン最大セッションとメインポートを設定する>スタドアロン、最大セッションとメインポートを設定する</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar standalone --max-sessions 4 --port 4444
</code></pre><h4 id=ハブ新規セッションリクエストのタイムアウトメインポートを設定しトレースを無効にする>ハブ、新規セッションリクエストのタイムアウト、メインポートを設定し、トレースを無効にする</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub --session-request-timeout 500 --port 3333 --tracing false
</code></pre><h4 id=ノード最大-4-セッションデバッグログポート-7777-firefox-と-edge-のみ>ノード、最大 4 セッション、デバッグログ、ポート 7777, FireFox と Edge のみ</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --max-sessions 4 --log-level &#34;fine&#34; --port 7777 --driver-implementation &#34;firefox&#34; --driver-implementation &#34;edge&#34;
</code></pre><h4 id=ディストリビューターセッションマップ新規セッションキューの-url-を指定バスを無効にする>ディストリビューター、セッションマップ・新規セッションキューの URL を指定、バスを無効にする</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar distributor --sessions http://localhost:5556 --sessionqueue http://localhost:5559 --bind-bus false
</code></pre><h4 id=特定ノードにカスタム-capabilities-を設定する>特定ノードにカスタム capabilities を設定する</h4><p><strong>重要:</strong> カスタム capabilities は全てのノードに設定される必要があります。
また全てのセッションリクエストに含まれなければいけません。</p><h5 id=ハブの起動>ハブの起動</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub
</code></pre><h5 id=customcap-に-true-をセットしてノード-a-を起動する>customcap に <code>true</code> をセットしてノード A を起動する</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --detect-drivers false --driver-configuration display-name=&#34;Chrome (custom capability true)&#34; max-sessions=1 stereotype=&#39;{&#34;browserName&#34;:&#34;chrome&#34;,&#34;gsg:customcap&#34;:true}&#39; --port 6161
</code></pre><h5 id=customcap-に-false-をセットしてノード-b-を起動する>customcap に <code>false</code> をセットしてノード B を起動する</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --detect-drivers false --driver-configuration display-name=&#34;Chrome (custom capability true)&#34; max-sessions=1 stereotype=&#39;{&#34;browserName&#34;:&#34;chrome&#34;,&#34;gsg:customcap&#34;:false}&#39; --port 6262
</code></pre><h5 id=ノード-a-とマッチ>ノード A とマッチ</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>ChromeOptions</span> <span style=color:#000>options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ChromeOptions</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;gsg:customcap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>WebDriver</span> <span style=color:#000>driver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>URL</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;https://selenium.dev&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>ノード B とマッチさせるにはカスタム capability を <code>false</code> に設定します。</p><h4 id=enabling-managed-downloads-by-the-node>Enabling Managed downloads by the Node</h4><p>At times a test may need to access files that were downloaded by it on the Node.
To retrieve such files, following can be done.</p><h5 id=start-the-hub>Start the Hub</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub
</code></pre><h5 id=start-the-node-with-manage-downloads-enabled>Start the Node with manage downloads enabled</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --enable-managed-downloads true
</code></pre><h5 id=set-the-capability-at-the-test-level>Set the capability at the test level</h5><p>Tests that want to use this feature should set the capability <code>"se:downloadsEnabled"</code>to <code>true</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:downloadsEnabled&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h5 id=how-does-this-work>How does this work</h5><ul><li>The Grid infrastructure will try to match a session request with <code>"se:downloadsEnabled"</code> against ONLY those nodes which were started with <code>--enable-managed-downloads true</code></li><li>If a session is matched, then the Node automatically sets the required capabilities to let the browser know, as to where should a file be downloaded.</li><li>The Node now allows a user to:<ul><li>List all the files that were downloaded for a specific session and</li><li>Retrieve a specific file from the list of files.</li></ul></li><li>The directory into which files were downloaded for a specific session gets automatically cleaned up when the session ends (or) timesout due to inactivity.</li></ul><p><strong>Note: Currently this capability is ONLY supported on:</strong></p><ul><li><code>Edge</code></li><li><code>Firefox</code> and</li><li><code>Chrome</code> browser</li></ul><h5 id=listing-files-that-can-be-downloaded-for-current-session>Listing files that can be downloaded for current session:</h5><ul><li>The endpoint to <code>GET</code> from is <code>/session/&lt;sessionId>/se/files</code>.</li><li>The session needs to be active in order for the command to work.</li><li>The raw response looks like below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;names&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In the response the list of file names appear under the key <code>names</code>.</p><h5 id=dowloading-a-file>Dowloading a file:</h5><ul><li>The endpoint to <code>POST</code> from is <code>/session/&lt;sessionId>/se/files</code> with a payload of the form <code>{"name": "fileNameGoesHere}</code></li><li>The session needs to be active in order for the command to work.</li><li>The raw response looks like below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;filename&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Base64EncodedStringContentsOfDownloadedFileAsZipGoesHere&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>The response blob contains two keys,<ul><li><code>filename</code> - The file name that was downloaded.</li><li><code>contents</code> - Base64 encoded zipped contents of the file.</li></ul></li><li>The file contents are Base64 encoded and they need to be unzipped.</li></ul><h5 id=list-files-that-can-be-downloaded>List files that can be downloaded</h5><p>The below mentioned <code>curl</code> example can be used to list all the files that were downloaded by the current session in the Node, and which can be retrieved locally.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X GET <span style=color:#4e9a06>&#34;http://localhost:4444/session/90c0149a-2e75-424d-857a-e78734943d4c/se/files&#34;</span>
</span></span></code></pre></div><p>A sample response would look like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;names&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=retrieve-a-downloaded-file>Retrieve a downloaded file</h5><p>Assuming the downloaded file is named <code>Red-blue-green-channel.jpg</code>, and using <code>curl</code>, the
file could be downloaded with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#4e9a06>&#34;Accept: application/json&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>-H <span style=color:#4e9a06>&#34;Content-Type: application/json; charset=utf-8&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>-X POST -d <span style=color:#4e9a06>&#39;{&#34;name&#34;:&#34;Red-blue-green-channel.jpg&#34;}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#4e9a06>&#34;http://localhost:4444/session/18033434-fa4f-4d11-a7df-9e6d75920e19/se/files&#34;</span>
</span></span></code></pre></div><p>A sample response would look like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;filename&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;UEsDBBQACAgIAJpagVYAAAAAAAAAAAAAAAAaAAAAUmVkLWJsAAAAAAAAAAAAUmVkLWJsdWUtZ3JlZW4tY2hhbm5lbC5qcGdQSwUGAAAAAAEAAQBIAAAAcNkAAAAA&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=complete-sample-code-in-java>Complete sample code in Java</h5><p>Below is an example in Java that does the following:</p><ul><li>Sets the capability to indicate that the test requires automatic managing of downloaded files.</li><li>Triggers a file download via a browser.</li><li>Lists the files that are available for retrieval from the remote node (These are essentially files that were downloaded in the current session)</li><li>Picks one file and downloads the file from the remote node to the local machine.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>java.util.Collections.singletonMap</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>org.openqa.selenium.remote.http.Contents.string</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.File</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.lang.reflect.Type</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.net.URL</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.List</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.Map</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.concurrent.TimeUnit</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.By</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.WebElement</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.firefox.FirefoxOptions</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.io.Zip</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.json.Json</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.json.TypeToken</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.Contents</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpClient</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpMethod</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpRequest</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpResponse</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DownloadsSample</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Assuming the Grid is running locally.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>URL</span> <span style=color:#000>gridUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>URL</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>RemoteWebDriver</span> <span style=color:#000>driver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>firefoxOptions</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>demoFileDownloads</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>demoFileDownloads</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RemoteWebDriver</span> <span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>URL</span> <span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Make sure the following directory exists on your machine
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>File</span> <span style=color:#000>dirToCopyTo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>File</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/usr/downloads/file&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://the-internet.herokuapp.com/download&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>WebElement</span> <span style=color:#000>element</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findElement</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>By</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>cssSelector</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;.example a&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>    <span style=color:#000>element</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>click</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// The download happens in a remote Node, which makes it difficult to know when the file
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// has been completely downloaded. For demonstration purposes, this example uses a
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 10-second sleep which should be enough time for a file to be downloaded.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// We strongly recommend to avoid hardcoded sleeps, and ideally, to modify your
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// application under test so it offers a way to know when the file has been completely
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// downloaded.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>TimeUnit</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SECONDS</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>//This is the endpoint which will provide us with list of files to download and also to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//let us download a specific file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>String</span> <span style=color:#000>uri</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>format</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/session/%s/se/files&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSessionId</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>String</span> <span style=color:#000>fileToDownload</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpClient</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>HttpClient</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Factory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createDefault</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>createClient</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// To list all files that are were downloaded on the remote node for the current session
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#8f5902;font-style:italic>// we trigger GET request.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>HttpRequest</span> <span style=color:#000>request</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HttpRequest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GET</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>HttpResponse</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>client</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>String</span> <span style=color:#000>text</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Type</span> <span style=color:#000>responseType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TypeToken</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}.</span><span style=color:#c4a000>getType</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Json</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>responseType</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>parsedResponse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>eachFile</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>parsedResponse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;names&#34;</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>fileToDownload</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// Let&#39;s say there were &#34;n&#34; files downloaded for the current session, we would like
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>          <span style=color:#8f5902;font-style:italic>// to retrieve ONLY the first file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>          <span style=color:#000>fileToDownload</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>eachFile</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpClient</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>HttpClient</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Factory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createDefault</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>createClient</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// To retrieve a specific file from one or more files that were downloaded by the current session
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#8f5902;font-style:italic>// on a remote node, we use a POST request.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>      <span style=color:#000>HttpRequest</span> <span style=color:#000>request</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HttpRequest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>POST</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setContent</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Contents</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>asJson</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>singletonMap</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>fileToDownload</span><span style=color:#ce5c00;font-weight:700>)));</span>
</span></span><span style=display:flex><span>      <span style=color:#000>HttpResponse</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>client</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>String</span> <span style=color:#000>text</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Type</span> <span style=color:#000>responseType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TypeToken</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}.</span><span style=color:#c4a000>getType</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Json</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>responseType</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>parsedResponse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// The returned map would contain 2 keys,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#8f5902;font-style:italic>// filename - This represents the name of the file (same as what was provided by the test)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#8f5902;font-style:italic>// contents - Base64 encoded String which contains the zipped file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>String</span> <span style=color:#000>encodedContents</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>parsedResponse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;contents&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>//The file contents would always be a zip file and has to be unzipped.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>Zip</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>unzip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>encodedContents</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dirToCopyTo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;The file which was &#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;downloaded in the node is now available in the directory: &#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>dirToCopyTo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getAbsolutePath</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#000>FirefoxOptions</span> <span style=color:#000>firefoxOptions</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>FirefoxOptions</span> <span style=color:#000>options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FirefoxOptions</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// This capability tells the Grid, that this test should be routed ONLY to a node that can
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// auto manage downloads.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:downloadsEnabled&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Options specific for Firefox to avoid prompting a dialog for downloads. They might
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// change in the future, so please refer to the Firefox documentation for up to date details.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPreference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;browser.download.manager.showWhenStarting&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPreference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;browser.helperApps.neverAsk.saveToDisk&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;images/jpeg, application/pdf, application/octet-stream&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPreference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;pdfjs.disabled&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e617239c5efb3fbc97f69447f5ba5981>4.3 - Toml オプション</h1><div class=lead>Tomlファイルを使用したGridの設定例.</div><p><a href=/ja/documentation/grid/configuration/cli_options/>CLI オプション</a> に記載されている全てのオプションは
<a href=https://github.com/toml-lang/toml>TOML</a> ファイルでも設定ができます。
このページでは異なる Grid コンポーネントの設定例を紹介します。</p><div class="pageinfo pageinfo-primary"><p>オプションが変更、または追加されたが文書化されていない場合、
このドキュメントは古くなる可能性があることに注意してください。
もしそのような状況を見つけたら、<a href=/ja/documentation/grid/configuration/help/>&ldquo;構成ヘルプ&rdquo;</a>を確認し、
ドキュメントを更新するプルリクエストを気軽に送ってください。</p></div><h2 id=概要>概要</h2><p>Selenium Grid は<a href=https://github.com/toml-lang/toml>TOML</a>フォーマットの設定ファイルを使用します。
設定ファイルはセクションで構成され、各セクションはオプションとその値が設定されています。</p><p>詳しい使い方は<a href=https://toml.io/ja/>TOML ドキュメント</a>を参照してください。
パースエラーに遭遇した場合、<a href=https://www.toml-lint.com/>TOML リンター</a>を使って検証してください。</p><p>一般的な設定の構成は以下のパターンです:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>section1</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option1</span><span style=color:#000;font-weight:700>=</span><span style=color:#4e9a06>&#34;value&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>section2</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option2</span><span style=color:#000;font-weight:700>=[</span><span style=color:#4e9a06>&#34;value1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;value2&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option3</span><span style=color:#000;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span>
</span></span></code></pre></div><p>TOML ファイルで設定された Grid コンポーネントを起動するには以下のように起動できます:</p><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar &lt;component&gt; --config /path/to/file/&lt;file-name&gt;.toml
</code></pre><h3 id=スタンドアロン>スタンドアロン</h3><p>ポート 4449 で動作し、新規セッションリクエストのタイムアウトが 500 秒のスタンドアロンサーバー。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>port</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4449</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessionqueue</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>session-request-timeout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>500</span>
</span></span></code></pre></div><h3 id=特定のブラウザとセッションの上限>特定のブラウザとセッションの上限</h3><p>Firefox と Chrome のみがデフォルトで有効になっているスタンドアロンサーバー、またはノード</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;chrome&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;firefox&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span></code></pre></div><h3 id=ドライバーのカスタマイズと設定>ドライバーのカスタマイズと設定</h3><p>Firefox Beta や Nightly のような、異なるブラウザのバージョンを持つことができるカスタマイズされた
ドライバを用いた、スタンドアロン、またはノード。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>100</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Firefox Nightly&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;firefox\&#34;, \&#34;browserVersion\&#34;: \&#34;93\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;moz:firefoxOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Firefox Nightly.app/Contents/MacOS/firefox-bin\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Chrome Beta&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;94\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;goog:chromeOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Google Chrome Beta.app/Contents/MacOS/Google Chrome Beta\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Chrome Dev&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;95\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;goog:chromeOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Google Chrome Dev.app/Contents/MacOS/Google Chrome Dev\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>webdriver-executable</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/path/to/chromedriver/95/chromedriver&#39;</span>
</span></span></code></pre></div><h3 id=docker-を利用したスタンドアロンまたはノード>Docker を利用したスタンドアロン、またはノード</h3><p>Docker コンテナでセッションを実行できるスタンドアロン、またはノードサーバー。
ドライバを検出を無効にし、最大 2 つの同時セッションを持ちます。
ステレオタイプは、Docker イメージにマッピングされる必要があり、
Docker デーモンが http/tcp で公開されている必要があります。
また、<code>devices</code>プロパティを用いて、ホスト上でアクセス可能なデバイスファイルを、コンテナで利用できるようにすることも可能です。
Docker デバイスをマッピングする詳しい方法は<a href=https://docs.docker.com/engine/reference/commandline/run/#add-host-device-to-container---device>docker</a>
を参照してください。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>docker</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>configs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;selenium/standalone-chrome:93.0&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;91\&#34;}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;selenium/standalone-firefox:92.0&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;firefox\&#34;, \&#34;browserVersion\&#34;: \&#34;92\&#34;}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#Optionally define all device files that should be mapped to docker containers</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#devices = [</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#    &#34;/dev/kvm:/dev/kvm&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#]</span>
</span></span><span style=display:flex><span><span style=color:#000>url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://localhost:2375&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>video-image</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;selenium/video:latest&#34;</span>
</span></span></code></pre></div><h3 id=webdriver-をサポートするサービスエンドポイントへのコマンド中継>WebDriver をサポートするサービスエンドポイントへのコマンド中継</h3><p>WebDriver をサポートする外部サービスを Selenium Grid に接続すると便利です。
例えばクラウドプロバイダーや Appium サーバーなどです。
Grid はローカルに存在しないプラットフォームやバージョンなどを幅広くカバーできるようになります。</p><p>以下は Appium サーバーを Grid に接続する例です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>relay</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Default Appium/Cloud server endpoint</span>
</span></span><span style=display:flex><span><span style=color:#000>url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://localhost:4723/wd/hub&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>status-endpoint</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/status&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Stereotypes supported by the service. The initial number is &#34;max-sessions&#34;, and will allocate</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># that many test slots to that particular configuration</span>
</span></span><span style=display:flex><span><span style=color:#000>configs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;platformName\&#34;: \&#34;android\&#34;, \&#34;appium:platformVersion\&#34;: \&#34;11\&#34;}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h3 id=basic-認証の有効化>Basic 認証の有効化</h3><p>ルーター、ハブ、スタンドアロンにユーザー名とパスワードを設定することで、
Basic 認証で Grid を保護することができます。
このユーザーとパスワードは、Grid UI を読み込む時や
新しいセッションを開始する時に必要になります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>router</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>username</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;admin&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>password</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;myStrongPassword&#34;</span>
</span></span></code></pre></div><p>Java でユーザーとパスワードを使ってセッションを開始する方法の例です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>URL</span> <span style=color:#000>gridUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>URL</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://admin:myStrongPassword@localhost:4444&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>RemoteWebDriver</span> <span style=color:#000>webDriver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ChromeOptions</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span></code></pre></div><h3 id=特定のノードにマッチするカスタム-capabilities-の設定>特定のノードにマッチするカスタム capabilities の設定</h3><p><strong>重要</strong>: カスタム capabilities は全てのノードで設定する必要があります。
また全てのセッションリクエストで常に含まれる必要があります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;firefox&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;{&#34;browserName&#34;: &#34;firefox&#34;, &#34;platformName&#34;: &#34;macOS&#34;, &#34;browserVersion&#34;:&#34;96&#34;, &#34;networkname:applicationName&#34;:&#34;node_1&#34;, &#34;nodename:applicationName&#34;:&#34;app_1&#34; }&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span></code></pre></div><p>Java でノードにマッチさせる方法の例です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>FirefoxOptions</span> <span style=color:#000>options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FirefoxOptions</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;networkname:applicationName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;node_1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;nodename:applicationName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;app_1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setBrowserVersion</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;96&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setPlatformName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;macOS&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>WebDriver</span> <span style=color:#000>driver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RemoteWebDriver</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>URL</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>options</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;https://selenium.dev&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>driver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><h3 id=enabling-managed-downloads-by-the-node>Enabling Managed downloads by the Node.</h3><p>The Node can be instructed to manage downloads automatically. This will cause the Node to save all files that were downloaded for a particular session into a temp directory, which can later be retrieved from the node.
To turn this capability on, use the below configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>enable-managed-downloads</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span></code></pre></div><p>Refer to the <a href=/ja/documentation/grid/configuration/cli_options/#complete-sample-code-in-java>CLI section</a> for a complete example.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9c11ba83187c12a3cd6b4a1789bae031>5 - Grid アーキテクチャ</h1><p>Grid は、Grid を運用するためのコンポーネントの集合体として設計されています。
非常に複雑に見えるかもしれませんが、
このドキュメントが混乱を解消する手助けとなることを期待します。</p><h2 id=キーとなるコンポーネント>キーとなるコンポーネント</h2><p>主要な Grid のコンポーネント:</p><dl><dt>イベントバス<dd>他のコンポーネント間で非同期で受信される可能性のあるメッセージを送信します。<dt>新規セッションキュー<dd>まだディストリビューターによってノードに割り当てられていない
受信セッションの一覧を管理します。<dt>ディストリビューター<dd>Grid内で<a href=https://w3c.github.io/webdriver/#dfn-sessions>WebDriverセッション
</a>を実行する場所（"スロット"と呼ぶ）を管理し、
新しいセッションリクエストを受け取りスロットに割り当てる役割を担います。<dt>ノード<dd><a href=https://w3c.github.io/webdriver/#dfn-sessions>WebDriverセッション
</a>を実行します。各セッションはスロットに割り当てられ、
各ノードは1つ以上のスロットを持っています。<dt>セッションマップ<dd><a href=https://w3c.github.io/webdriver/#dfn-session-id>セッションID</a>
とセッションが実行されているノードのアドレスのマップを管理します。<dt>ルーター<dd>Gridのフロントエンドとして動作します。
Gridの中で唯一ウェブに公開してもよい部分です（ただし、公開しないことを強く推奨します）。
受け取ったリクエストを新規セッションキューかセッションが実行されているノードどちらかに振り分けます。</dl><p>グリッドについて説明する際に、覚えておくと便利な概念がいくつかあります:</p><ul><li><strong>スロット</strong> はセッションが実行されるところです。</li><li>各スロットは <strong>ステレオタイプ</strong> を持っています。これは
ディストリビューターがスロットを所有するノードに
<a href=https://w3c.github.io/webdriver/#new-session>新規セッション</a> リクエストを送信する前に、
リクエストがマッチしなければならない最小限の capabilities のセットです。</li><li><strong>Grid モデル</strong> はディストリビューターが Grid の状態を追跡する方法です。
その名が示すように、これは時々実際と一致しないことがあります
（ディストリビューターが開始したばかりだからかもしれません）。
ディストリビューターが新規セッションのリクエストを素早くスロットに割り当てることができるように、
各ノードに問い合わせるより優先して利用されます。</li></ul><h2 id=同期呼び出しと非同期呼び出し>同期呼び出しと非同期呼び出し</h2><p>Grid 内では主に 2 つの通信メカニズムが使われています。</p><ol><li>同期で &ldquo;REST 風&rdquo; な、JSON を用いた HTTP リクエスト</li><li>イベントバスによって送信される非同期なイベント</li></ol><p>どちらの仕組みを使うべきかどのように決めればよいでしょうか？
結局のところ、Grid 全体をイベントベースにモデリングしたとしても、
うまくいくでしょう。</p><p>答えは、もし実行されるアクションが同期である場合(例えばほとんどの WebDriver の呼び出しなど)、
あるいはレスポンスを受け取れなかったときに問題になるような場合、
Grid は同期呼び出しを利用します。かわりにもし、関心のあるコンポーネントに情報を
ブロードキャストしたい場合、あるいはレスポンスを受け取れなくても問題にならない場合は
イベントバスを使用することが望ましいです。</p><p>特筆する点として、非同期呼び出しは同期呼び出しよりも、
よりリスナーが分離されています。</p><h2 id=起動シーケンスとコンポーネント間の依存>起動シーケンスとコンポーネント間の依存</h2><p>Grid はコンポーネントを任意の順番で起動できるように設計されていますが、
概念的にはコンポーネントが起動する順番は:</p><ol><li>イベントバスとセッションマップが最初に起動します。これらは
他のコンポーネントへの依存もお互いの依存もないため、
並列に開始しても安全です。</li><li>次に 新規セッションキューが起動します。</li><li>ここでディストリビューターが起動できるようになります。これは
定期的に 新規セッションキューに接続し、ジョブをポーリングします。
このポーリングはイベント（新規セッションがキューに追加された）あるいは
定期的な間隔によって行われる可能性があります。</li><li>ルーターを起動できます。新しいセッションのリクエストは
新規セッションキューに送られ、ディストリビューターはセッションを実行する
スロットを探そうとします。</li><li>これでノードを起動することができます。ノードが Grid に登録されるまでの
流れは後述します。登録が完了すると、Grid はトラフィックを提供することが
できるようになります。</li></ol><p>コンポーネント間の依存関係を以下のよう表すことができます。
&ldquo;✅&rdquo; は同期的な依存関係があることを示しています。</p><table><thead><tr><th></th><th>イベントバス</th><th>ディストリビューター</th><th>ノード</th><th>ルーター</th><th>セッションマップ</th><th>新規セッションキュー</th></tr></thead><tbody><tr><td>イベントバス</td><td>X</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>ディストリビューター</td><td>✅</td><td>X</td><td>✅</td><td></td><td></td><td>✅</td></tr><tr><td>ノード</td><td>✅</td><td></td><td>X</td><td></td><td></td><td></td></tr><tr><td>ルーター</td><td></td><td></td><td>✅</td><td>X</td><td>✅</td><td></td></tr><tr><td>セッションマップ</td><td></td><td></td><td></td><td></td><td>X</td><td></td></tr><tr><td>新規セッションキュー</td><td>✅</td><td></td><td></td><td></td><td></td><td>X</td></tr></tbody></table><h2 id=ノードの登録>ノードの登録</h2><p>Grid に新しいノードを登録するプロセスは軽量です。</p><ol><li>ノードは開始する時 &ldquo;ハートビート&rdquo; イベントを発信する必要があります。
このハートビートは<a href=https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/grid/data/NodeStatus.html>Node Status</a>を含んでいます.</li><li>ディストリビューターはハートビートイベントを受け取ります。
受け取ったら、ノードの <code>/status</code> エンドポイントに <code>GET</code> リクエストを試みます。
この情報をもとに Grid が設定されます。</li></ol><p>ディストリビューターは同じ <code>/status</code> エンドポイントを使用して、定期的にノードをチェックしますが、
ノードは起動した後もハートビートを送り続けなければなりません。
これにより、ディストリビューターは Grid の状態を永続化しませんが、
再起動しても Grid を（最終的に）最新の状態にすることができます。</p><h3 id=node-status-オブジェクト>Node Status オブジェクト</h3><p>Node Status は以下のフィールドを持つ JSON オブジェクトです:</p><table><thead><tr><th>名前</th><th>型</th><th>概要</th></tr></thead><tbody><tr><td>availability</td><td>string</td><td><code>up</code>, <code>draining</code>, <code>down</code> のいずれかの文字列です。重要なのは <code>draining</code> で、これはノードに新しいセッションを送らないことを示し、最後のセッションが終了するとノードは終了、または再起動します。</td></tr><tr><td>externalUrl</td><td>string</td><td>Grid 内の他のコンポーネントが接続するための URI。</td></tr><tr><td>lastSessionCreated</td><td>integer</td><td>このノードで最後にセッションが作成された時間のエポックタイムスタンプです。ディストリビューターは、他の条件がすべて同じであれば、最も長くアイドルであったノードに新しいセッションを送信しようとします。</td></tr><tr><td>maxSessionCount</td><td>integer</td><td>セッション数は利用可能なスロット数をカウントすることで推測できますが、この値はノードが「満杯」とみなされるまでに、ノード上で同時に実行されるセッションの最大数を決定するために使用されます。</td></tr><tr><td>nodeId</td><td>string</td><td>ノード ID を識別する UUID です。</td></tr><tr><td>osInfo</td><td>object</td><td><code>arch</code>, <code>name</code>, <code>version</code> フィールドを持つオブジェクトです。Grid UI と GraphQL クエリーで利用されます。</td></tr><tr><td>slots</td><td>array</td><td>Slot オブジェクト(以下を参照)の配列。</td></tr><tr><td>version</td><td>string</td><td>ノードのバージョン(Selenium では、これは Selenium のバージョンと同じです)。</td></tr></tbody></table><p>すべてのフィールドの値を設定することが推奨されます。</p><h3 id=slot-オブジェクト>Slot オブジェクト</h3><p>Slot オブジェクトは 1 ノードでの 1 スロットを表します。
1 スロットにつき 1 セッションを実行することができます。
1 つのノードが同時に実行できる数よりも多くのスロットを持つことができます。
例えばあるノードが 10 セッションまで同時に実行でき、
それらのセッションは Chrome, Edge, Firefox のどの組み合わせでも良い時、
ノードは &lsquo;max session count&rsquo; を 10 として、
10 の Chrome スロット、10 の Edge スロット、10 の Firefox スロットを持ちます。</p><table><thead><tr><th>名前</th><th>型</th><th>概要</th></tr></thead><tbody><tr><td>id</td><td>string</td><td>スロット ID。</td></tr><tr><td>lastStarted</td><td>string</td><td>スロットが最後にセッションを開始した時間。ISO-8601 フォーマット。</td></tr><tr><td>stereotype</td><td>object</td><td>このスロットがマッチする最小限の<a href=https://w3c.github.io/webdriver/#dfn-merging-capabilities>capabilities</a> のセット。 最小の例: <code>{"browserName": "firefox"}</code></td></tr><tr><td>session</td><td>object</td><td>Session オブジェクト(以下を参照)。</td></tr></tbody></table><h3 id=session-オブジェクト>Session オブジェクト</h3><p>スロットで実行中のセッションを表します。</p><table><thead><tr><th>名前</th><th>型</th><th>概要</th></tr></thead><tbody><tr><td>capabilities</td><td>object</td><td>セッションが持つ実際の capabilities。 The actual capabilities provided by the session. <a href=https://w3c.github.io/webdriver/#new-session>新規セッション</a>コマンドの戻り値と同じです。</td></tr><tr><td>startTime</td><td>string</td><td>セッションが開始した時間。ISO-8601 フォーマット。</td></tr><tr><td>stereotype</td><td>object</td><td>このスロットがマッチする最小限の<a href=https://w3c.github.io/webdriver/#dfn-merging-capabilities>capabilities</a> のセット。 最小の例: <code>{"browserName": "firefox"}</code></td></tr><tr><td>uri</td><td>string</td><td>ノードがセッションに接続するための URI。</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-abac6f77089fbf05fa24eca43aebeddf>6 - 高度な機能</h1><div class=lead>高度な機能のすべての詳細を取得し、それがどのように機能するか、および独自の設定方法を理解するには、次のセクションを参照してください。</div></div><div class=td-content><h1 id=pg-cff3310fa01f534cfe804c3e76ae9056>6.1 - 可観測性</h1><h2 id=目次>目次</h2><ul><li><a href=#selenium-grid>Selenium Grid</a></li><li><a href=#%E5%8F%AF%E8%A6%B3%E6%B8%AC%E6%80%A7>可観測性</a><ul><li><a href=#%E5%88%86%E6%95%A3%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%B3%E3%82%B0>分散トレーシング</a></li><li><a href=#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%AD%E3%82%AE%E3%83%B3%E3%82%B0>イベントロギング</a></li></ul></li><li><a href=#Grid-%E3%81%AE%E5%8F%AF%E8%A6%B3%E6%B8%AC%E6%80%A7>Grid の可観測性</a><ul><li><a href=#%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96>トレースの可視化</a></li><li><a href=#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%AD%E3%82%B0%E3%81%AE%E6%B4%BB%E7%94%A8>イベントログの活用</a></li></ul></li><li><a href=#%E5%8F%82%E8%80%83>参考</a></li></ul><h2 id=selenium-grid>Selenium Grid</h2><p>Grid は、さまざまなブラウザとオペレーティングシステムの組み合わせでテストを実行することにより、テストのスケーリングと分散を支援します。</p><h2 id=可観測性>可観測性</h2><p>可観測性(Observability) には、トレース、メトリクス、ログの 3 つの柱があります。
Selenium Grid 4 は完全分散型に設計されているため、可観測性を確保することで内部を理解し、デバッグすることが容易になります。</p><h2 id=分散トレーシング>分散トレーシング</h2><p>1 つのリクエストやトランザクションは、複数のサービスやコンポーネントにまたがります。
トレースは、各サービスがリクエストを実行する際に、リクエストのライフサイクルをトラックします。これは、エラーシナリオのデバッグに有用です。
トレースで使用される用語は次のとおりです:</p><p><strong>トレース</strong>
トレースでは、複数のサービスを通じてリクエストの出発点から最終地点までを追跡することができます。
このリクエストの旅は、デバッグ、エンドツーエンドフローの監視、障害の特定に役立ちます。
トレースは、エンドツーエンドのリクエストフローを描きます。
各トレースは識別子としてユニークな ID を持っています。</p><p><strong>スパン</strong></p><p>各トレースは、スパンと呼ばれる時間で区切られたオペレーションで構成されています。
スパンには開始時刻と終了時刻があり、サービスによって実行される操作を表します。
スパンの粒度は実装方法に依存します。各スパンは一意の識別子を持ちます。
トレース内のすべてのスパンは、同じトレース ID を持ちます。</p><p><strong>スパン属性</strong>
スパン属性は各スパンの付加的な情報を提供するキーと値のペアです。</p><p><strong>イベント</strong>
イベントは、スパン内のタイムスタンプ付きログです。
既存のスパンに追加のコンテキストを提供します。
イベントには、イベント属性としてキーと値のペアも含まれます。</p><h2 id=イベントロギング>イベントロギング</h2><p>アプリケーションのデバッグには、ロギングが欠かせません。
ログの記録は多くの場合、人間が読める形式で行われます。
しかし、機械がログを検索・分析するためには、明確に定義されたフォーマットである必要があります。
構造化ロギングは、固定フォーマットで一貫してログを記録する一般的な方法です。
一般的には次のようなフィールドが含まれます。</p><ul><li>タイムスタンプ</li><li>ログレベル</li><li>ロガークラス</li><li>ログメッセージ (これはさらに、ログが記録された操作に関するフィールドに分解されます)</li></ul><p>ログとイベントは密接に関連しています。
イベントは、1 つの処理を行うための情報を全てカプセル化します。
ログは基本的にイベントのサブセットです。
重要なのは、どちらもデバッグを支援することです。
詳細については、以下のリソースを参照してください。</p><ol><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/</a></li><li><a href=https://charity.wtf/2019/02/05/logs-vs-structured-events/>https://charity.wtf/2019/02/05/logs-vs-structured-events/</a></li></ol><h2 id=grid-の可観測性>Grid の可観測性</h2><p>Selenium サーバーは OpenTelemetry を使ってトレースできるようになっています。
サーバへのすべてのリクエストは、最初から最後までトレースされます。
各トレースは、リクエストがサーバ内で実行されるときの一連のスパンから構成されます。
Selenium サーバのスパンのほとんどは、2 つのイベントから構成されています。</p><ol><li>通常イベント- 単一の処理に関するすべての情報を記録し、処理が正常に完了したことを知らせます。</li><li>エラーイベント- エラーが発生するまでのすべての情報を記録し、エラー情報を記録します。例外イベントをマークします。</li></ol><p>Selenium サーバーを起動する:</p><ol><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#standalone-mode>スタンドアロン</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#hub-and-node>ハブ・ノード</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#fully-distributed>完全分散モード</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#using-docker>Docker</a></li></ol><h2 id=トレースの可視化>トレースの可視化</h2><p>すべてのスパン、イベント、およびそれぞれの属性がトレースの一部となります。
トレースは、上記のすべてのモードでサーバを実行している間動作します。
トレースはデフォルトで Selenium サーバで有効になっています。</p><p>Selenium サーバーは、2 つのエクスポーター経由でトレースをエクスポートします。</p><ol><li>コンソール - すべてのトレースと、それに含まれるスパンを FINE レベルでログに出力します。デフォルトでは、Selenium サーバーは INFO レベル以上のログを出力します。
<strong>log-level</strong> フラグを使うと、Selenium Grid jar を実行する際に任意のログレベルを指定することができます。</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar standalone --log-level FINE
</span></span></code></pre></div><ol start=2><li>Jaeger UI - OpenTelemetry は、コード内のトレースを計測するための API と SDK を提供します。一方、Jaeger はトレースのバックエンドで、トレースのテレメトリデータを収集し、データのクエリ、フィルタリング、ビジュアライズの機能を提供します。</li></ol><p>Jaeger UI を用いたトレースの可視化の詳細な手順を確認するには、次のコマンドを実行してください:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar info tracing
</span></span></code></pre></div><p><a href=https://github.com/manoj9788/tracing-selenium-grid>非常に参考になる例と、Jaeger にトレースを送信するスクリプトです</a></p><h2 id=イベントログの活用>イベントログの活用</h2><p>トレースを可視化しない場合でも、イベントロギングではトレースを有効にする必要があります。
<strong>デフォルトでは、トレースは有効です。コンソールでログを見るために、追加のパラメータを渡す必要はありません。</strong>
スパン内のすべてのイベントは FINE レベルでログに記録されます。エラーイベントは、WARN レベルでログに記録されます。</p><p>全てのイベントは次のフィールドを持ちます:</p><table><thead><tr><th>フィールド</th><th>フィールド名</th><th>概要</th></tr></thead><tbody><tr><td>イベント時刻</td><td>eventId</td><td>イベントのタイムスタンプ(エポックナノ秒)。</td></tr><tr><td>トレース ID</td><td>tracedId</td><td>各トレースはトレース ID で一意に識別されます。</td></tr><tr><td>スパン ID</td><td>spanId</td><td>トレース内の各スパンは、スパン ID により一意に識別されます。</td></tr><tr><td>スパン種別</td><td>spanKind</td><td>スパン種別は、スパンの種類を示すスパンのプロパティです。スパンの処理の性質を識別するのに役立ちます。</td></tr><tr><td>イベント名</td><td>eventName</td><td>ログメッセージにマッピングされます。</td></tr><tr><td>イベント属性</td><td>eventAttributes</td><td>イベントログの核となるもので、実行された操作に基づいて JSON フォーマットのキーと値のペアが用意されています。また、ロガークラスを表示するために、ハンドラークラスアトリビュートも含まれます。</td></tr></tbody></table><p>サンプルログ</p><pre><code>FINE [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;fc8aef1d44b3cc8bc09eb8e581c4a8eb&quot;,
  &quot;spanId&quot;: &quot;b7d3b9865d3ddd45&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597819675128886121,
  &quot;eventName&quot;: &quot;Session request execution complete&quot;,
  &quot;attributes&quot;: {
    &quot;http.status_code&quot;: 200,
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.router.HandleSession&quot;,
    &quot;http.url&quot;: &quot;\u002fsession\u002fdd35257f104bb43fdfb06242953f4c85&quot;,
    &quot;http.method&quot;: &quot;DELETE&quot;,
    &quot;session.id&quot;: &quot;dd35257f104bb43fdfb06242953f4c85&quot;
  }
}
</code></pre><p>上記のフィールドに加えて、<a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/exceptions.md>OpenTelemetry の仕様</a>に基づきエラーログは以下のフィールドで構成されます:</p><table><thead><tr><th>フィールド</th><th>フィールド名</th><th>概要</th></tr></thead><tbody><tr><td>例外タイプ</td><td>exception.type</td><td>例外クラス名。</td></tr><tr><td>例外メッセージ</td><td>exception.message</td><td>例外の原因。</td></tr><tr><td>スタックトレース</td><td>exception.stacktrace</td><td>例外が発生した時点のコールスタックを表示します。 例外の発生源を把握するのに役立ちます。</td></tr></tbody></table><p>サンプルエラーログ</p><pre><code>WARN [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;7efa5ea57e02f89cdf8de586fe09f564&quot;,
  &quot;spanId&quot;: &quot;914df6bc9a1f6e2b&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597820253450580272,
  &quot;eventName&quot;: &quot;exception&quot;,
  &quot;attributes&quot;: {
    &quot;exception.type&quot;: &quot;org.openqa.selenium.ScriptTimeoutException&quot;,
    &quot;exception.message&quot;: &quot;Unable to execute request: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist ...&quot; (full message will be printed),
    &quot;exception.stacktrace&quot;: &quot;org.openqa.selenium.ScriptTimeoutException: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist\nBuild info: version: '4.0.0-alpha-7', revision: 'Unknown'\nSystem info: host: 'XYZ-MacBook-Pro.local', ip: 'fe80:0:0:0:10d5:b63a:bdc6:1aff%en0', os.name: 'Mac OS X', os.arch: 'x86_64', os.version: '10.13.6', java.version: '11.0.7'\nDriver info: driver.version: unknown ....&quot; (full stack will be printed),
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.distributor.remote.RemoteDistributor&quot;,
    &quot;http.url&quot;: &quot;\u002fsession&quot;,
    &quot;http.method&quot;: &quot;POST&quot;
  }
}
</code></pre><p>注: ログは読みやすさのためプリティプリントされています。Selenimu サーバーではぷるティプリントはオフになっています。</p><p>以上がトレースとログをセットアップするための手順です。</p><h2 id=参考>参考</h2><ol><li><a href=https://lightstep.com/blog/opentelemetry-101-what-is-tracing/>Understanding Tracing</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/api.md#status>OpenTelemetry Tracing API Specification</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki>Selenium Wiki</a></li><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>Structured logs vs events</a></li><li><a href=https://github.com/jaegertracing/jaeger>Jaeger framework</a></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-b11540ed82255545d0e8201c6e111a70>6.2 - GraphQLクエリのサポート</h1><p>GraphQLは、APIのクエリ言語であり、既存のデータでこれらのクエリを実行するためのランタイムです。
これにより、ユーザーは必要なものだけを正確に要求することができます。</p><h2 id=列挙型enum>列挙型(Enum)</h2><p>列挙型は、フィールドの可能な値のセットを表します。</p><p>たとえば、 <code>Node</code> オブジェクトには <code>status</code> というフィールドがあります。
<code>UP</code> 、 <code>DRAINING</code> 、または <code>UNAVAILABLE</code> の可能性があるため、状態は、 列挙型（具体的には、<code>Status</code> タイプ）です。</p><h2 id=スカラー>スカラー</h2><p>スカラーはプリミティブ値です： <code>Int</code> 、 <code>Float</code> 、 <code>String</code> 、 <code>Boolean</code> 、または <code>ID</code> 。</p><p>GraphQL APIを呼び出すときは、スカラーのみを返すまでネストされたサブフィールドを指定する必要があります。</p><h2 id=スキーマの構造>スキーマの構造</h2><p>グリッドスキーマの構造は次のとおりです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    session<span style=color:#ce5c00;font-weight:700>(</span>id: <span style=color:#4e9a06>&#34;&lt;session-id&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        id,
</span></span><span style=display:flex><span>        capabilities,
</span></span><span style=display:flex><span>        startTime,
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        nodeId,
</span></span><span style=display:flex><span>        nodeUri,
</span></span><span style=display:flex><span>        sessionDurationMillis
</span></span><span style=display:flex><span>        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            id,
</span></span><span style=display:flex><span>            stereotype,
</span></span><span style=display:flex><span>            lastStarted
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    grid: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        totalSlots,
</span></span><span style=display:flex><span>        nodeCount,
</span></span><span style=display:flex><span>        maxSession,
</span></span><span style=display:flex><span>        sessionCount,
</span></span><span style=display:flex><span>        version,
</span></span><span style=display:flex><span>        sessionQueueSize
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    sessionsInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        sessionQueueRequests,
</span></span><span style=display:flex><span>        sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                capabilities,
</span></span><span style=display:flex><span>                startTime,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                nodeId,
</span></span><span style=display:flex><span>                nodeUri,
</span></span><span style=display:flex><span>                sessionDurationMillis
</span></span><span style=display:flex><span>                slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    id,
</span></span><span style=display:flex><span>                    stereotype,
</span></span><span style=display:flex><span>                    lastStarted
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    nodesInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        nodes : <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                status,
</span></span><span style=display:flex><span>                maxSession,
</span></span><span style=display:flex><span>                slotCount,
</span></span><span style=display:flex><span>                sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                        id,
</span></span><span style=display:flex><span>                        capabilities,
</span></span><span style=display:flex><span>                        startTime,
</span></span><span style=display:flex><span>                        uri,
</span></span><span style=display:flex><span>                        nodeId,
</span></span><span style=display:flex><span>                        nodeUri,
</span></span><span style=display:flex><span>                        sessionDurationMillis
</span></span><span style=display:flex><span>                        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                            id,
</span></span><span style=display:flex><span>                            stereotype,
</span></span><span style=display:flex><span>                            lastStarted
</span></span><span style=display:flex><span>                        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>]</span>,
</span></span><span style=display:flex><span>                sessionCount,
</span></span><span style=display:flex><span>                stereotypes,
</span></span><span style=display:flex><span>                version,
</span></span><span style=display:flex><span>                osInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    arch,
</span></span><span style=display:flex><span>                    name,
</span></span><span style=display:flex><span>                    version
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=graphqlで照会する>GraphQLで照会する</h2><p>GraphQLをクエリする最良の方法は、 <code>curl</code> リクエストを使用することです。
GraphQLを使用すると、必要なデータのみをフェッチできます。それ以上でもそれ以下でもありません。</p><p>GraphQLクエリの例のいくつかを以下に示します。 必要に応じて独自のクエリを作成できます。</p><h3 id=グリッド内の-maxsessionと-sessioncountの数を照会する>グリッド内の <code>maxSession</code>と<code> sessionCount</code>の数を照会する</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ grid { maxSession, sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><p>通常、ローカルマシンでは、 <code>&lt;LINK_TO_GRAPHQL_ENDPOINT></code> は <code>http://localhost:4444/graphql</code> になります。</p><h3 id=セッションノードグリッドのすべての詳細を照会する>セッション、ノード、グリッドのすべての詳細を照会する</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { uri, maxSession, sessionCount }, nodesInfo { nodes { id, uri, status, sessions { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } }, slotCount, sessionCount }} }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッドで現在のセッション数を取得するためのクエリ>グリッドで現在のセッション数を取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッドで最大セッション数を取得するためのクエリ>グリッドで最大セッション数を取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { maxSession } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッド内のすべてのノードのすべてのセッションの詳細を取得するためのクエリ>グリッド内のすべてのノードのすべてのセッションの詳細を取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, capabilities, startTime, uri, nodeId, nodeId, sessionDurationMillis } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッド内の各ノードのすべてのセッションのスロット情報を取得するためのクエリ>グリッド内の各ノードのすべてのセッションのスロット情報を取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, slot { id, stereotype, lastStarted } } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=特定のセッションのセッション情報を取得するためのクエリ>特定のセッションのセッション情報を取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ session (id: \&#34;&lt;session-id&gt;\&#34;) { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } } } &#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッド内の各ノードのcapabilityを照会する>グリッド内の各ノードのcapabilityを照会する</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { stereotypes } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=グリッド内の各ノードのステータスを照会する>グリッド内の各ノードのステータスを照会する</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { status } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=各ノードとグリッドのuriを照会する>各ノードとグリッドのURIを照会する</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { uri } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=新しいセッションキューで現在のリクエストを取得するためのクエリ>新しいセッションキューで現在のリクエストを取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessionQueueRequests } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=新しいセッションキューのサイズを取得するためのクエリ>新しいセッションキューのサイズを取得するためのクエリ</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionQueueSize } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d62408233c3d62bcee1fef32842d1ecd>6.3 - Grid エンドポイント</h1><h2 id=grid>Grid</h2><h3 id=grid-ステータス>Grid ステータス</h3><p>Grid ステータスは Grid の現在の状態を提供します。 登録されている全てのノードの詳細で構成されます。
各ノードのステータスには、ノードの稼働状況、セッション、およびスロットに関する情報が含まれます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL GET <span style=color:#4e9a06>&#39;http://localhost:4444/status&#39;</span>
</span></span></code></pre></div><p>スタンドアロンモードでは、Grid URL は スタンドアロンサーバーのアドレスになります。</p><p>ハブ&ノードモードでは、Grid URL は ハブのアドレスになります。</p><p>完全分散モードでは、Grid URL は ルーターのアドレスになります。</p><p>上記すべてのモードのデフォルトの URL は http://localhost:4444 です。</p><h2 id=ディストリビューター>ディストリビューター</h2><h3 id=ノード削除>ノード削除</h3><p>ノードを Grid から削除するには、以下の cURL コマンドを使用します。
このコマンドは、そのノード上で実行中のセッションを停止させるものではありません。
ノードは明示的に強制終了されない限り、そのまま動作し続けます。
ディストリビューターはそのノードを認識しなくなるため、マッチする新しいセッションのリクエストは はその Node に転送されません。</p><p>スタンドアロンモードでは、ディストリビューターの URL はスタンドアロンサーバーのアドレスとなります。</p><p>ハブ&ノードモードでは、ディストリビューターの URL は ハブのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>完全分散モードでは、ディストリビューター URL は ディストリビューターのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:5553/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;Distributor-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=ノードのドレイン>ノードのドレイン</h3><p>ノードドレインコマンドはノードをグレースフルシャットダウンするために利用します。
ドレインは実行中のセッションがすべて完了した後にノードを停止します。
新規のセッションは受け付けません。</p><p>スタンドアロンモードでは、ディストリビューターの URL はスタンドアロンサーバーのアドレスとなります。</p><p>ハブ&ノードモードでは、ディストリビューターの URL は ハブのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>完全分散モードでは、ディストリビューター URL は ディストリビューターのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:5553/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;Distributor-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=ノード>ノード</h2><p>この節でのエンドポイントは、ハブ&ノードモードとノードが独立して動作する完全分散型 Grid モードに適用されます。
ノードが 1 つの場合、デフォルトのノード URL は http://localhost:5555 です。
複数のノードがある場合は、<a href=#grid-%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9>Grid ステータス</a> を使ってすべてのノードの詳細とノードアドレスを取得してください。</p><h3 id=ステータス>ステータス</h3><p>ノードステータスは基本的にノードのヘルスチェックのためのものです。
ディストリビューターは定期的にノードの状態を ping で取得し、それに応じて Grid モデルを更新します。
ステータスには稼働状況、セッション、およびスロットに関する情報が含まれます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/status&#39;</span>
</span></span></code></pre></div><h3 id=ドレイン>ドレイン</h3><p>ディストリビューターは <a href=#%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E3%83%89%E3%83%AC%E3%82%A4%E3%83%B3>ドレイン</a>コマンドを適切なノードに渡します。
ノードを直接ドレインするには以下の cURL コマンドを使います。
どちらのエンドポイントも有効であり、同じ結果になります。
ドレインは、ノードを停止する前に進行中のセッションを終了させます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=セッションオーナーのチェック>セッションオーナーのチェック</h3><p>あるセッションがノードに属しているかどうかをチェックするには、以下の cURL コマンドを使います。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><p>もしセッションがノードに属していたら true を返し、そうでなければ false が返ります。</p><h3 id=セッションの削除>セッションの削除</h3><p>セッションを削除すると、WebDriver セッションが終了し、ドライバがアクティブなセッションマップから削除されます。
削除されたセッション ID を使用するリクエストや、ドライバのインスタンスを再利用しようとすると、エラーとなります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=新規セッションキュー>新規セッションキュー</h2><h3 id=新規セッションキューのクリア>新規セッションキューのクリア</h3><p>新規セッションキューには、新規セッションリクエストが格納されます。
キューをクリアするには、以下に挙げる cURL コマンドを使用します。
キューを消去すると、キューにあるすべてのリクエストを拒否します。
サーバーは各リクエストのそれぞれのクライアントにエラーレスポンスを返します。
クリアコマンドの結果は、削除されたリクエストの数です。</p><p>スタンドアロンモードでは、キューの URL はスタンドアロンサーバーのアドレスとなります。</p><p>ハブ&ノードモードでは、キューの URL は ハブのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>完全分散モードでは、キューの URL は 新規セッションキューのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:5559/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Grid の設定時に登録用の secret を設定していない場合は次のようにします:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;URL&gt;/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=新規セッションリクエストの取得>新規セッションリクエストの取得</h3><p>新規セッションキューには、新規セッションリクエストが格納されます。
キューにある現在のリクエストを取得するには、以下に挙げる cURL コマンドを使用します。
レスポンスはキュー内のリクエストの数とリクエストのペイロードを返します。</p><p>スタンドアロンモードでは、キューの URL はスタンドアロンサーバーのアドレスとなります。</p><p>ハブ&ノードモードでは、キューの URL は ハブのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div><p>完全分散モードでは、キューの URL は 新規セッションキューのアドレスになります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5559/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5b5dba3035d5fdea37ea443e04bc3675>6.4 - Customizing a Node</h1><div class="pageinfo pageinfo-warning"><p class=lead><i class="fas fa-language display-4"></i>
Page being translated from
English to Japanese. Do you speak Japanese? Help us to translate
it by sending us pull requests!</p></div><h2 id=how-to-customize-a-node>How to customize a Node</h2><p>There are times when we would like a Node to be customized to our needs.</p><p>For e.g., we may like to do some additional setup before a session begins execution and some clean-up after a session runs to completion.</p><p>Following steps can be followed for this:</p><ul><li><p>Create a class that extends <code>org.openqa.selenium.grid.node.Node</code></p></li><li><p>Add a static method (this will be our factory method) to the newly created class whose signature looks like this:</p><p><code>public static Node create(Config config)</code>. Here:</p><ul><li><code>Node</code> is of type <code>org.openqa.selenium.grid.node.Node</code></li><li><code>Config</code> is of type <code>org.openqa.selenium.grid.config.Config</code></li></ul></li><li><p>Within this factory method, include logic for creating your new Class.</p></li><li><p>To wire in this new customized logic into the hub, start the node and pass in the fully qualified class name of the above class to the argument <code>--node-implementation</code></p></li></ul><p>Let&rsquo;s see an example of all this:</p><h3 id=custom-node-as-an-uber-jar>Custom Node as an uber jar</h3><ol><li>Create a sample project using your favourite build tool (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Add the below dependency to your sample project.<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Add your customized Node to the project.</li><li>Build an <a href=https://imagej.net/develop/uber-jars>uber jar</a> to be able to start the Node using <code>java -jar</code> command.</li><li>Now start the Node using the command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar custom_node-server.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p><strong>Note:</strong> If you are using Maven as a build tool, please prefer using <a href=https://maven.apache.org/plugins/maven-shade-plugin>maven-shade-plugin</a> instead of <a href=https://maven.apache.org/plugins/maven-assembly-plugin>maven-assembly-plugin</a> because maven-assembly plugin seems to have issues with being able to merge multiple Service Provider Interface files (<code>META-INF/services</code>)</p><h3 id=custom-node-as-a-regular-jar>Custom Node as a regular jar</h3><ol><li>Create a sample project using your favourite build tool (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Add the below dependency to your sample project.<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Add your customized Node to the project.</li><li>Build a jar of your project using your build tool.</li><li>Now start the Node using the command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar selenium-server-4.6.0.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext custom_node-1.0-SNAPSHOT.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p>Below is a sample that just prints some messages on to the console whenever there&rsquo;s an activity of interest (session created, session deleted, a webdriver command executed etc.,) on the Node.</p><details><summary>Sample customized node</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.seleniumhq.samples</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.net.URI</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.UUID</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.Capabilities</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.NoSuchSessionException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.WebDriverException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.config.Config</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.data.CreateSessionRequest</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.data.CreateSessionResponse</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.data.NodeId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.data.NodeStatus</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.data.Session</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.log.LoggingOptions</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.node.HealthCheck</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.node.Node</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.node.local.LocalNodeFactory</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.security.Secret</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.security.SecretOptions</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.grid.server.BaseServerOptions</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.internal.Either</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.SessionId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpRequest</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.http.HttpResponse</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.openqa.selenium.remote.tracing.Tracer</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DecoratedLoggingNode</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Node</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>protected</span> <span style=color:#000>DecoratedLoggingNode</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Tracer</span> <span style=color:#000>tracer</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>URI</span> <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Secret</span> <span style=color:#000>registrationSecret</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>tracer</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>NodeId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UUID</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>randomUUID</span><span style=color:#ce5c00;font-weight:700>()),</span> <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>registrationSecret</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#000>Node</span> <span style=color:#000>create</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Config</span> <span style=color:#000>config</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>LoggingOptions</span> <span style=color:#000>loggingOptions</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>LoggingOptions</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BaseServerOptions</span> <span style=color:#000>serverOptions</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BaseServerOptions</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>URI</span> <span style=color:#000>uri</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>serverOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getExternalUri</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SecretOptions</span> <span style=color:#000>secretOptions</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SecretOptions</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Refer to the foot notes for additional context on this line.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>Node</span> <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>LocalNodeFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>create</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>DecoratedLoggingNode</span> <span style=color:#000>wrapper</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DecoratedLoggingNode</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>loggingOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTracer</span><span style=color:#ce5c00;font-weight:700>(),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>secretOptions</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRegistrationSecret</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#000>wrapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>node</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>wrapper</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>WebDriverException</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>CreateSessionResponse</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>newSession</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#000>CreateSessionRequest</span> <span style=color:#000>sessionRequest</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before newSession()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newSession</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sessionRequest</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After newSession()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>HttpResponse</span> <span style=color:#000>executeWebDriverCommand</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpRequest</span> <span style=color:#000>req</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before executeWebDriverCommand(): &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>req</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUri</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeWebDriverCommand</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After executeWebDriverCommand()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Session</span> <span style=color:#000>getSession</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SessionId</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>NoSuchSessionException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getSession()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSession</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getSession()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>HttpResponse</span> <span style=color:#000>uploadFile</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HttpRequest</span> <span style=color:#000>req</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>SessionId</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before uploadFile()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>uploadFile</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After uploadFile()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>stop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SessionId</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>NoSuchSessionException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before stop()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>stop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After stop()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isSessionOwner</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SessionId</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isSessionOwner()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isSessionOwner</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isSessionOwner()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isSupporting</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Capabilities</span> <span style=color:#000>capabilities</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isSupporting&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isSupporting</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>capabilities</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isSupporting()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>NodeStatus</span> <span style=color:#000>getStatus</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getStatus()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getStatus()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>HealthCheck</span> <span style=color:#000>getHealthCheck</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getHealthCheck()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHealthCheck</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getHealthCheck()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>drain</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before drain()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>drain</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After drain()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isReady</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isReady()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isReady</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isReady()&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></details><p><strong><em>Foot Notes:</em></strong></p><p>In the above example, the line <code>Node node = LocalNodeFactory.create(config);</code> explicitly creates a <code>LocalNode</code>.</p><p>There are basically 2 types of <em>user facing implementations</em> of <code>org.openqa.selenium.grid.node.Node</code> available.</p><p>These classes are good starting points to learn how to build a custom Node and also to learn the internals of a Node.</p><ul><li><code>org.openqa.selenium.grid.node.local.LocalNode</code> - Used to represent a long running Node and is the default implementation that gets wired in when you start a <code>node</code>.<ul><li>It can be created by calling <code>LocalNodeFactory.create(config);</code>, where:<ul><li><code>LocalNodeFactory</code> belongs to <code>org.openqa.selenium.grid.node.local</code></li><li><code>Config</code> belongs to <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li><li><code>org.openqa.selenium.grid.node.k8s.OneShotNode</code> - This is a special reference implementation wherein the Node gracefully shuts itself down after servicing one test session. This class is currently not available as part of any pre-built maven artifact.<ul><li>You can refer to the source code <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/java/src/org/openqa/selenium/grid/node/k8s/OneShotNode.java>here</a> to understand its internals.</li><li>To build it locally refer <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/deploys/k8s/README.md>here</a>.</li><li>It can be created by calling <code>OneShotNode.create(config)</code>, where:<ul><li><code>OneShotNode</code> belongs to <code>org.openqa.selenium.grid.node.k8s</code></li><li><code>Config</code> belongs to <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e65991b592e30916d941bdbfabb53abe>6.5 - External datastore</h1><div class="pageinfo pageinfo-warning"><p class=lead><i class="fas fa-language display-4"></i>
Page being translated from
English to Japanese. Do you speak Japanese? Help us to translate
it by sending us pull requests!</p></div><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=#introduction>Introduction</a></li><li><a href=#setup>Setup</a></li><li><a href=#database-backed-session-map>Database backed Session Map</a><ul><li><a href=#steps>Steps</a></li></ul></li><li><a href=#redis-backed-session-map>Redis backed Session Map</a><ul><li><a href=#steps>Steps</a></li></ul></li></ul><h2 id=introduction>Introduction</h2><p>Selenium Grid allows you to persist information related to currently running sessions into an external data store.
The external data store could be backed by your favourite database (or) Redis Cache system.</p><h2 id=setup>Setup</h2><ul><li><a href=https://get-coursier.io/docs/cli-installation>Coursier</a> - As a dependency resolver, so that we can download maven artifacts on the fly and make them available in our classpath</li><li><a href=https://docs.docker.com/engine/install/>Docker</a> - To manage our PostGreSQL/Redis docker containers.</li></ul><h2 id=database-backed-session-map>Database backed Session Map</h2><p>For the sake of this illustration, we are going to work with PostGreSQL database.</p><p>We will spin off a PostGreSQL database as a docker container using a docker compose file.</p><h3 id=steps>Steps</h3><p>You can skip this step if you already have a PostGreSQL database instance available at your disposal.</p><ul><li>Create a sql file named <code>init.sql</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessions_map</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_ids</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_caps</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_uri</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_stereotype</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>In the same directory as the <code>init.sql</code>, create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres:9.6-bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_USER=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_PASSWORD=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_DB=selenium_sessions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;5432:5432&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>./init.sql:/docker-entrypoint-initdb.d/init.sql</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our database container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p><em>Our database name is <code>selenium_sessions</code> with its username and password set to <code>seluser</code></em></p><p>If you are working with an already running PostGreSQL DB instance, then you just need to create a database named <code>selenium_sessions</code> and the table <code>sessions_map</code> using the above mentioned SQL statement.</p><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.jdbc.JdbcBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbc:postgresql://localhost:5432/selenium_sessions&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-user</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-password</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing PostGreSQL DB instance, then replace <code>localhost:5432</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed Grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Sessions Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>init.sql</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the PostGreSQL database.</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-jdbc>selenium-session-map-jdbc</a> which is needed to help us store sessions information in database</li><li><a href=https://mvnrepository.com/artifact/org.postgresql/postgresql>postgresql</a> which is needed to help us talk PostGreSQL database.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul><h2 id=redis-backed-session-map>Redis backed Session Map</h2><p>We will spin off a Redis Cache docker container using a docker compose file.</p><h3 id=steps-1>Steps</h3><p>You can skip this step if you already have a Redis Cache instance available at your disposal.</p><ul><li>Create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>redis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redis:bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;6379:6379&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our Redis container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>scheme</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;redis&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.redis.RedisBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>hostname</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>port</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6379</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing Redis Cache instance, then replace <code>localhost</code> and <code>6379</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Session Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the Redis instance. You can perhaps make use of a Redis GUI such as <a href=https://tableplus.com/>TablePlus</a> to see them (Make sure that you have setup a debug point in your test, because the values will get deleted as soon as the test runs to completion).</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-redis>selenium-session-map-redis</a> which is needed to help us store sessions information in Redis Cache.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul></div></main></div></div><div class="row justify-content-center p-5"><h2 class="selenium text-center">Selenium Level Sponsors</h2></div><div class="row justify-content-around pt-4 pb-5 px-5"><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="http://www.browserstack.com/automate/?utm_campaign=open-source-sponsor&utm_source=seleniumorg&utm_medium=referral" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/browserstack.png alt=BrowserStack></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=http://saucelabs.com class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/saucelabs.png alt="Sauce Labs"></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=http://bit.ly/36uZ7ad class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/experitest.png alt=Experitest></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=https://applitools.com/ class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/applitools.png alt=Applitools></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=https://www.perfecto.io/ class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/perfecto-perforce.jpg alt=Perfecto></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=https://www.lambdatest.com/selenium-automation class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/lambda-test.png alt=LambdaTest></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.subject-7.com/unified-testing/?utm_source=selenium&utm_medium=unifiedtesting&utm_campaign=product" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/subject7_logo.png alt=Subject7></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.avoautomation.ai/why-avo//?utm_source=SeleniumHQ&utm_medium=listing&utm_campaign=SeleniumHQ" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/Avo_logo.png alt="Avo Automation"></a></div></div><div class="row justify-content-center pt-2 pb-3 -bg-selenium-cyan"><div class="card text-center border-0 bg-transparent py-5"><div class=card-body><h2 class=card-title>Support the Selenium Project</h2><p class=card-text>Want to support the Selenium project? Learn more or view the full list of sponsors.</p><div class=selenium-button-container><a href=/sponsors class="selenium-button selenium-white-cyan text-uppercase font-weight-bold">Learn more
<i class="pl-3 fas fa-caret-right"></i></a></div></div></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/group/selenium-users aria-label="User mailing list"><i class="fas fa-mail-bulk"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Selenium in Twitter" aria-label="Selenium in Twitter"><a class=text-white target=_blank rel=noopener href=https://twitter.com/SeleniumHQ aria-label="Selenium in Twitter"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="SeleniumConf YouTube Channel" aria-label="SeleniumConf YouTube Channel"><a class=text-white target=_blank rel=noopener href=https://www.youtube.com/channel/UCbDlgX_613xNMrDqCe3QNEw aria-label="SeleniumConf YouTube Channel"><i class="fab fa-youtube"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Selenium in Facebook" aria-label="Selenium in Facebook"><a class=text-white target=_blank rel=noopener href=https://www.facebook.com/Selenium2.WebDriver aria-label="Selenium in Facebook"><i class="fab fa-facebook"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Software Freedom Conservancy" aria-label="Software Freedom Conservancy"><a class=text-white target=_blank rel=noopener href=mailto:selenium@sfconservancy.org aria-label="Software Freedom Conservancy"><i class="fas fa-envelope-square"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/seleniumhq/selenium aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://join.slack.com/t/seleniumhq/shared_invite/zt-1neaoa52v-FTzht5cd2eYKwSobbhQkEw aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=IRC aria-label=IRC><a class=text-white target=_blank rel=noopener href=https://kiwiirc.com/nextclient/irc.libera.chat/#selenium aria-label=IRC><i class="fas fa-comments"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/selenium-developers aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><a href=https://www.netlify.com><img src=https://www.netlify.com/v3/img/components/netlify-light.svg alt="Deploys by Netlify"></a></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Software Freedom Conservancy All Rights Reserved</small><p class=mt-2><a href=/ja/documentation/about/>このドキュメントについて</a></p></div></div></div></footer></div><script src=/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin=anonymous></script>
<script src=/js/prism.js></script>
<script src=/js/tabpane-persist.js></script>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>docsearch({container:"#docsearch",appId:"6IOXA5JK7Z",indexName:"selenium",apiKey:"2b44a1d3530f9951dd6502059058984a",debug:!1})</script></body></html>